<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple KARV Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; }
        .result { margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
        pre { font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ Simple KARV Test</h1>
    <p>Testing KARV industry detection with the exact same approach as the main system</p>
    
    <button onclick="testKarv()">Test KARV Industry Detection</button>
    
    <div id="result" class="result">Click button to test...</div>

    <script>
        async function testKarv() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                console.log('üß™ Testing KARV industry detection...');
                
                // This mimics exactly what aiIndustryExpansionService.smartIndustryDetection() does
                const response = await fetch('https://zskaxjtyuaqazydouifp.supabase.co/functions/v1/ai-industry-expansion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpza2F4anR5dWFxYXp5ZG91aWZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMjk2MzcsImV4cCI6MjA3MDcwNTYzN30.5PhMVptHk3n-1dTSwGF-GvTwrVM0loovkHGUBDtBOe8'
                    },
                    body: JSON.stringify({
                        organization_name: 'KARV Global',
                        website: 'https://www.karv.global/',
                        description: 'Global communications and PR agency',
                        current_categories: []
                    })
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    const data = await response.json();
                    console.log('Response data:', data);
                    
                    if (data.success && data.analysis) {
                        const industry = data.analysis.primary_industry;
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <h3>‚úÖ SUCCESS!</h3>
                            <p><strong>KARV Industry Detected:</strong> ${industry}</p>
                            <p><strong>Expected:</strong> Should be PR/Communications related (not "technology")</p>
                            <p><strong>Result:</strong> ${industry.toLowerCase().includes('public') || industry.toLowerCase().includes('relations') || industry.toLowerCase().includes('communication') ? '‚úÖ CORRECT - Not tech company!' : '‚ö†Ô∏è Check if this is better than "technology"'}</p>
                            
                            <h4>Top Competitors Found:</h4>
                            <p>${data.analysis.direct_competitors.slice(0, 5).join(', ')}</p>
                            
                            <details>
                                <summary>Full Analysis</summary>
                                <pre>${JSON.stringify(data.analysis, null, 2)}</pre>
                            </details>
                        `;
                        
                        // Test what the smartIndustryDetection function would return
                        const smartDetection = {
                            industry: data.analysis.primary_industry,
                            confidence: 'high',
                            source: 'ai_analysis',
                            subcategories: data.analysis.subcategories,
                            competitors: data.analysis.direct_competitors.slice(0, 10),
                            stakeholders: data.analysis.stakeholder_groups.slice(0, 8)
                        };
                        
                        console.log('üéØ Smart detection result:', smartDetection);
                        
                    } else {
                        throw new Error('Invalid response structure: ' + JSON.stringify(data));
                    }
                } else {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Test Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check browser console for details.</p>
                `;
            }
        }
        
        // Auto-run test
        window.addEventListener('load', () => {
            setTimeout(testKarv, 1000);
        });
    </script>
</body>
</html>