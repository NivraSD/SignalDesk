{"ast":null,"code":"import _objectSpread from\"/Users/jonathanliebowitz/Desktop/SignalDesk/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{supabase}from'../../config/supabase';import{getUnifiedOrganization,getUnifiedOpportunityConfig}from'../../utils/unifiedDataLoader';import'./OpportunityModulePR.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OpportunityModulePR=_ref=>{let{organizationId,sharedIntelligence,onIntelligenceUpdate}=_ref;const[activeTab,setActiveTab]=useState('active');const[opportunities,setOpportunities]=useState([]);const[rawIntelligence,setRawIntelligence]=useState(null);const[filters,setFilters]=useState({stakeholder:'all',urgency:'all',type:'all'});const[loading,setLoading]=useState(true);const[selectedOpportunity,setSelectedOpportunity]=useState(null);useEffect(()=>{const orgData=getUnifiedOrganization();console.log('ðŸ” OpportunityModulePR - Organization data:',orgData);if(orgData&&orgData.name){console.log('âœ… Calling gatherPRIntelligence for:',orgData.name);gatherPRIntelligence(orgData);}else{console.error('âš ï¸ No organization data found');setOpportunities([]);setLoading(false);}},[organizationId]);const gatherPRIntelligence=async orgData=>{setLoading(true);try{console.log('ðŸŽ¯ Gathering PR Intelligence for:',orgData.name);// Get opportunity config\nconst opportunityConfig=getUnifiedOpportunityConfig();// Call existing opportunity orchestrator with proper config structure\nconst{data,error}=await supabase.functions.invoke('opportunity-orchestrator',{body:{organization:{name:orgData.name,industry:orgData.industry||'technology'},config:_objectSpread(_objectSpread({},opportunityConfig),{},{opportunity_types:opportunityConfig.opportunity_types||{competitor_weakness:true,narrative_vacuum:true,cascade_effect:true,crisis_prevention:true,viral_moment:false}}),forceRefresh:true// Force fresh data\n}});if(!error&&data){console.log('âœ… PR Intelligence gathered:',data);// Check if we got opportunities\nif(data.opportunities&&data.opportunities.length>0){// Store raw intelligence for Intelligence Hub to use\nsetRawIntelligence(data.intelligence);// Share intelligence with other modules\nif(onIntelligenceUpdate){onIntelligenceUpdate(data.intelligence);}// Process opportunities for PR action\nconst prOpportunities=processPROpportunities(data.opportunities,orgData);setOpportunities(prOpportunities);}else{console.warn('ðŸ“­ No opportunities returned from API');setOpportunities([]);}}else{console.error('âŒ API error:',error);console.error('âš ï¸ No opportunities returned. Check Supabase functions and API keys.');setOpportunities([]);}}catch(error){console.error('âŒ Error gathering PR intelligence:',error);setOpportunities([]);}finally{setLoading(false);}};const processPROpportunities=(opportunities,orgData)=>{return opportunities.map(opp=>_objectSpread(_objectSpread({},opp),{},{urgency:calculateUrgency(opp),stakeholders_affected:opp.stakeholders||['media'],cascade_risk:opp.cascade_risk||'medium',action_plan:generateActionPlan(opp,orgData),rationale:generateRationale(opp,orgData)}));};const calculateUrgency=opportunity=>{// Calculate based on time window and cascade risk\nif(opportunity.window_hours&&opportunity.window_hours<24)return'critical';if(opportunity.window_hours&&opportunity.window_hours<72)return'high';if(opportunity.cascade_risk==='high')return'high';if(opportunity.window_hours&&opportunity.window_hours<168)return'medium';return'low';};const generateActionPlan=(opportunity,orgData)=>{// Generate specific action steps based on opportunity type\nconst plans={'narrative_vacuum':['Draft thought leadership piece within 24 hours','Identify and brief spokesperson','Pitch to top-tier media outlets','Amplify through owned channels'],'competitor_weakness':['Prepare competitive differentiation messaging','Brief sales team on talking points','Consider strategic media placement','Monitor competitor response'],'cascade_prevention':['Assess stakeholder sentiment immediately','Prepare holding statement','Identify and engage key influencers','Setup monitoring for narrative spread'],'media_opportunity':['Reach out to journalist within 2 hours','Prepare expert spokesperson','Develop supporting assets','Follow up with exclusive angle']};return plans[opportunity.opportunity_type]||['Assess opportunity relevance','Develop messaging strategy','Execute tactical plan','Monitor results'];};const generateRationale=(opportunity,orgData)=>{// Explain why this matters for PR strategy\nreturn opportunity.rationale||\"This \".concat(opportunity.opportunity_type,\" opportunity allows \").concat(orgData.name,\" to shape the narrative before competitors and control the message across key stakeholder groups.\");};const getSamplePROpportunities=orgData=>{var _orgData$competitors,_orgData$industry;// Industry-specific PR opportunities\nconst industryOpportunities={'food':[{id:1,opportunity_type:'narrative_vacuum',title:'Health-conscious beverages trend lacks major brand voice',description:'Growing conversation about functional beverages with no major brand leading. Opportunity to position as health innovator.',urgency:'high',stakeholders_affected:['media','customers','influencers'],cascade_risk:'high',window_hours:72,action_plan:['Launch functional beverage innovation story','Partner with health influencers','Exclusive with health/wellness media'],rationale:'First mover advantage in functional beverage narrative could establish thought leadership position for next 6-12 months.'},{id:2,opportunity_type:'competitor_weakness',title:\"\".concat(((_orgData$competitors=orgData.competitors)===null||_orgData$competitors===void 0?void 0:_orgData$competitors[0])||'Competitor',\" facing sustainability criticism\"),description:'Major competitor receiving negative coverage on packaging sustainability. Window to highlight your sustainability initiatives.',urgency:'critical',stakeholders_affected:['media','activists','investors'],cascade_risk:'medium',window_hours:24,action_plan:['Publish sustainability report highlights','Offer executive for sustainability interviews','Amplify through ESG investor channels'],rationale:'Competitive differentiation opportunity while media is focused on sustainability in beverage industry.'}],'technology':[{id:1,opportunity_type:'cascade_prevention',title:'Early criticism in developer forums about API changes',description:'Negative sentiment building in developer community. Not yet in mainstream media.',urgency:'high',stakeholders_affected:['developers','media','customers'],cascade_risk:'high',window_hours:48,action_plan:['Direct developer relations outreach','Publish clarification blog post','Host emergency developer office hours','Prepare media holding statement'],rationale:'Addressing developer concerns now prevents cascade to tech media and customer sentiment.'}],'default':[{id:1,opportunity_type:'media_opportunity',title:'Industry trend piece seeking expert commentary',description:'Major outlet preparing industry analysis, seeking executive insights.',urgency:'high',stakeholders_affected:['media','investors','customers'],cascade_risk:'low',window_hours:24,action_plan:['Confirm executive availability','Prepare key message points','Provide supporting data','Follow up with additional angles'],rationale:'Positions organization as industry thought leader with high-visibility placement.'}]};const industry=((_orgData$industry=orgData.industry)===null||_orgData$industry===void 0?void 0:_orgData$industry.toLowerCase())||'default';// Map common industry variations\nif(industry==='beverages'||industry==='beverage'||industry==='food & beverage'){return industryOpportunities['food']||industryOpportunities.default;}return industryOpportunities[industry]||industryOpportunities.default;};const getUrgencyColor=urgency=>{const colors={critical:'#EF4444',high:'#F59E0B',medium:'#3B82F6',low:'#6B7280'};return colors[urgency]||'#6B7280';};const getStakeholderIcon=stakeholder=>{const icons={media:'ðŸ“°',customers:'ðŸ‘¥',investors:'ðŸ’¼',employees:'ðŸ‘”',regulators:'âš–ï¸',activists:'ðŸ“¢',influencers:'âœ¨'};return icons[stakeholder]||'ðŸ‘¤';};const renderOpportunityCard=opp=>/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opportunity-card\",onClick:()=>setSelectedOpportunity(opp),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opp-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-type\",children:opp.opportunity_type.replace(/_/g,' ').toUpperCase()}),/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-urgency\",style:{backgroundColor:getUrgencyColor(opp.urgency)},children:opp.urgency.toUpperCase()})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"pr-opp-title\",children:opp.title}),/*#__PURE__*/_jsx(\"p\",{className:\"pr-opp-description\",children:opp.description}),/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-stakeholders\",children:opp.stakeholders_affected.map(sh=>/*#__PURE__*/_jsxs(\"span\",{className:\"stakeholder-badge\",children:[getStakeholderIcon(sh),\" \",sh]},sh))}),/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opp-cascade\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"cascade-label\",children:\"Cascade Risk:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"cascade-level cascade-\".concat(opp.cascade_risk),children:opp.cascade_risk})]}),opp.window_hours&&/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opp-window\",children:[\"\\u23F1\\uFE0F Window: \",opp.window_hours<24?\"\".concat(opp.window_hours,\" hours\"):\"\".concat(Math.floor(opp.window_hours/24),\" days\")]})]},opp.id);const renderSelectedOpportunity=()=>{if(!selectedOpportunity)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opportunity-detail\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"close-detail\",onClick:()=>setSelectedOpportunity(null),children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"h2\",{children:selectedOpportunity.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCB Action Plan\"}),/*#__PURE__*/_jsx(\"ol\",{className:\"action-plan-list\",children:selectedOpportunity.action_plan.map((step,idx)=>/*#__PURE__*/_jsx(\"li\",{children:step},idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCA1 Strategic Rationale\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedOpportunity.rationale})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83C\\uDFAF Affected Stakeholders\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stakeholder-flow\",children:selectedOpportunity.stakeholders_affected.map((sh,idx)=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stakeholder-node\",children:[getStakeholderIcon(sh),/*#__PURE__*/_jsx(\"span\",{children:sh})]}),idx<selectedOpportunity.stakeholders_affected.length-1&&/*#__PURE__*/_jsx(\"span\",{className:\"flow-arrow\",children:\"\\u2192\"})]},sh))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",children:\"Start Campaign\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",children:\"Create Content\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",children:\"Monitor Progress\"})]})]});};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"module-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Gathering PR Intelligence...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opportunity-module\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"module-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"PR Opportunity Engine\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"stat-item\",children:[\"\\uD83C\\uDFAF \",opportunities.filter(o=>o.urgency==='critical'||o.urgency==='high').length,\" Urgent\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-item\",children:[\"\\u26A1 \",opportunities.filter(o=>o.cascade_risk==='high').length,\" High Cascade Risk\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"module-tabs\",children:[/*#__PURE__*/_jsx(\"button\",{className:activeTab==='active'?'active':'',onClick:()=>setActiveTab('active'),children:\"Active Opportunities\"}),/*#__PURE__*/_jsx(\"button\",{className:activeTab==='intelligence'?'active':'',onClick:()=>setActiveTab('intelligence'),children:\"Raw Intelligence\"}),/*#__PURE__*/_jsx(\"button\",{className:activeTab==='cascade'?'active':'',onClick:()=>setActiveTab('cascade'),children:\"Cascade Tracking\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"module-filters\",children:[/*#__PURE__*/_jsxs(\"select\",{value:filters.stakeholder,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{stakeholder:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Stakeholders\"}),/*#__PURE__*/_jsx(\"option\",{value:\"media\",children:\"Media\"}),/*#__PURE__*/_jsx(\"option\",{value:\"customers\",children:\"Customers\"}),/*#__PURE__*/_jsx(\"option\",{value:\"investors\",children:\"Investors\"}),/*#__PURE__*/_jsx(\"option\",{value:\"employees\",children:\"Employees\"}),/*#__PURE__*/_jsx(\"option\",{value:\"regulators\",children:\"Regulators\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:filters.urgency,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{urgency:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Urgency\"}),/*#__PURE__*/_jsx(\"option\",{value:\"critical\",children:\"Critical\"}),/*#__PURE__*/_jsx(\"option\",{value:\"high\",children:\"High\"}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:\"Medium\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:filters.type,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{type:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Types\"}),/*#__PURE__*/_jsx(\"option\",{value:\"narrative_vacuum\",children:\"Narrative Vacuum\"}),/*#__PURE__*/_jsx(\"option\",{value:\"competitor_weakness\",children:\"Competitor Weakness\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cascade_prevention\",children:\"Cascade Prevention\"}),/*#__PURE__*/_jsx(\"option\",{value:\"media_opportunity\",children:\"Media Opportunity\"}),/*#__PURE__*/_jsx(\"option\",{value:\"crisis_prevention\",children:\"Crisis Prevention\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"module-content\",children:selectedOpportunity?renderSelectedOpportunity():/*#__PURE__*/_jsx(\"div\",{className:\"opportunities-grid\",children:opportunities.filter(opp=>{if(filters.stakeholder!=='all'&&!opp.stakeholders_affected.includes(filters.stakeholder))return false;if(filters.urgency!=='all'&&opp.urgency!==filters.urgency)return false;if(filters.type!=='all'&&opp.opportunity_type!==filters.type)return false;return true;}).map(opp=>renderOpportunityCard(opp))})})]});};export default OpportunityModulePR;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}