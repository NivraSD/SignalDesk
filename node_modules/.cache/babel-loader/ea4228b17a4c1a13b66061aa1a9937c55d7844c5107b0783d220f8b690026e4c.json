{"ast":null,"code":"import _objectSpread from\"/Users/jonathanliebowitz/Desktop/SignalDesk/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\n * Intelligent Discovery Service\n * Automatically discovers everything about a company from just their name\n * No more asking users for data we can find ourselves\n */class IntelligentDiscoveryService{constructor(){this.supabaseUrl=process.env.REACT_APP_SUPABASE_URL||'https://zskaxjtyuaqazydouifp.supabase.co';this.supabaseKey=process.env.REACT_APP_SUPABASE_ANON_KEY||'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpza2F4anR5dWFxYXp5ZG91aWZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMjk2MzcsImV4cCI6MjA3MDcwNTYzN30.5PhMVptHk3n-1dTSwGF-GvTwrVM0loovkHGUBDtBOe8';this.cache=new Map();}/**\n   * Discover everything about a company from minimal input\n   */async discoverCompanyIntelligence(companyName){let website=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let description=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;console.log(\"\\uD83D\\uDD0D Starting intelligent discovery for \".concat(companyName));// DISABLED CACHE - was returning wrong company data\n// Cache was returning Netflix data for Mitsui & Co searches\n// Always do fresh discovery for accuracy\nconst cacheKey=\"\".concat(companyName,\"_\").concat(website);// Clear any existing cache for safety\nthis.cache.clear();try{var _companyAnalysis$comp,_companyAnalysis$topi,_companyAnalysis$keyw,_stakeholders$regulat,_stakeholders$media,_stakeholders$activis,_stakeholders$investo,_stakeholders$analyst;// Step 1: Use Claude to analyze the company\nconst companyAnalysis=await this.analyzeCompanyWithClaude(companyName,website,description);// Use Claude's data if available, otherwise discover manually\nconst competitors=((_companyAnalysis$comp=companyAnalysis.competitors)===null||_companyAnalysis$comp===void 0?void 0:_companyAnalysis$comp.length)>0?companyAnalysis.competitors:await this.discoverRealCompetitors(companyName,companyAnalysis.industry);const stakeholders=companyAnalysis.stakeholders?companyAnalysis.stakeholders:await this.mapRealStakeholders(companyName,companyAnalysis.industry);const topics=((_companyAnalysis$topi=companyAnalysis.topics)===null||_companyAnalysis$topi===void 0?void 0:_companyAnalysis$topi.length)>0?companyAnalysis.topics:await this.identifyRelevantTopics(companyAnalysis);const keywords=((_companyAnalysis$keyw=companyAnalysis.keywords)===null||_companyAnalysis$keyw===void 0?void 0:_companyAnalysis$keyw.length)>0?companyAnalysis.keywords:await this.generateSmartKeywords(companyName,companyAnalysis);console.log('üîß Discovery assembled:',{competitors:(competitors===null||competitors===void 0?void 0:competitors.length)||0,hasStakeholders:!!stakeholders,regulators:(stakeholders===null||stakeholders===void 0?void 0:(_stakeholders$regulat=stakeholders.regulators)===null||_stakeholders$regulat===void 0?void 0:_stakeholders$regulat.length)||0,media:(stakeholders===null||stakeholders===void 0?void 0:(_stakeholders$media=stakeholders.media)===null||_stakeholders$media===void 0?void 0:_stakeholders$media.length)||0,activists:(stakeholders===null||stakeholders===void 0?void 0:(_stakeholders$activis=stakeholders.activists)===null||_stakeholders$activis===void 0?void 0:_stakeholders$activis.length)||0,investors:(stakeholders===null||stakeholders===void 0?void 0:(_stakeholders$investo=stakeholders.investors)===null||_stakeholders$investo===void 0?void 0:_stakeholders$investo.length)||0,analysts:(stakeholders===null||stakeholders===void 0?void 0:(_stakeholders$analyst=stakeholders.analysts)===null||_stakeholders$analyst===void 0?void 0:_stakeholders$analyst.length)||0});const discovery={company:_objectSpread({name:companyName,website:website,description:description||companyAnalysis.description},companyAnalysis),competitors:competitors,stakeholders:stakeholders,topics:topics,keywords:keywords,monitoring_strategy:this.createMonitoringStrategy(companyAnalysis),discovered_at:new Date().toISOString()};// CACHE DISABLED - was causing cross-company data pollution\nreturn discovery;}catch(error){console.error('Discovery failed:',error);// Return minimal fallback\nreturn this.getFallbackDiscovery(companyName);}}/**\n   * Use Claude to understand the company\n   */async analyzeCompanyWithClaude(companyName,website,description){const prompt=\"\\n      Analyze this company and provide structured intelligence:\\n      Company: \".concat(companyName,\"\\n      Website: \").concat(website||'not provided',\"\\n      Description: \").concat(description||'not provided',\"\\n      \\n      Provide a JSON response with:\\n      1. industry: The PRIMARY industry (e.g., \\\"automotive\\\", \\\"finance\\\", \\\"technology\\\")\\n      2. sub_industry: More specific category\\n      3. business_model: How they make money\\n      4. market_position: leader/challenger/emerging/niche\\n      5. key_products: Main products/services\\n      6. target_customers: Who they sell to\\n      7. geographic_focus: Where they operate\\n      8. company_stage: startup/growth/mature/enterprise\\n      9. likely_pain_points: Current challenges they face\\n      10. description: One sentence describing what they do\\n      \\n      Be specific and accurate. If this is a well-known company, use your knowledge.\\n      For example:\\n      - Toyota = automotive giant, not tech company\\n      - Mitsui & Co = Japanese trading conglomerate (sogo shosha), not just \\\"finance\\\"\\n      - Goldman Sachs = investment banking, not generic \\\"finance\\\"\\n    \");try{console.log('üîç Calling Claude API for company analysis...');console.log('URL:',\"\".concat(this.supabaseUrl,\"/functions/v1/claude-intelligence-synthesizer-v2\"));console.log('Has API Key:',!!this.supabaseKey);const response=await fetch(\"\".concat(this.supabaseUrl,\"/functions/v1/claude-intelligence-synthesizer-v2\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(this.supabaseKey)},body:JSON.stringify({intelligence_type:'company_analysis',prompt:prompt,organization:{name:companyName}})});console.log('Response status:',response.status);if(response.ok){var _data$analysis,_data$analysis2,_data$analysis3;const data=await response.json();console.log('‚úÖ Claude API Response:',{success:data.success,hasAnalysis:!!data.analysis,competitors:(_data$analysis=data.analysis)===null||_data$analysis===void 0?void 0:_data$analysis.competitors,stakeholders:(_data$analysis2=data.analysis)===null||_data$analysis2===void 0?void 0:_data$analysis2.stakeholders,enhancedByClaude:(_data$analysis3=data.analysis)===null||_data$analysis3===void 0?void 0:_data$analysis3.enhanced_by_claude,fullData:data});// Make sure we return the full analysis with competitors\nif(data.analysis){console.log('üéØ Discovered competitors:',data.analysis.competitors);console.log('üéØ Discovered stakeholders:',data.analysis.stakeholders);return data.analysis;}console.warn('‚ö†Ô∏è No analysis in response, using default');return this.getDefaultAnalysis(companyName);}else{const errorText=await response.text();console.error('‚ùå Claude API error:',response.status,errorText);}}catch(error){console.error('‚ùå Claude analysis failed:',error);}return this.getDefaultAnalysis(companyName);}/**\n   * Discover REAL competitors, not placeholders\n   */async discoverRealCompetitors(companyName,industry){// Normalize industry name for lookup\nconst normalizedIndustry=(industry||'').toLowerCase();console.log('üîç Looking up competitors for:',companyName,'in industry:',normalizedIndustry);// Industry-specific real competitors\nconst competitorMap={automotive:{'Toyota':['Tesla','Volkswagen','General Motors','Ford','Stellantis','BYD','Honda','Hyundai'],'Tesla':['Toyota','Volkswagen','BYD','Rivian','Lucid','Polestar','NIO','Xpeng'],'Ford':['General Motors','Stellantis','Toyota','Tesla','Rivian','Volkswagen']},trading:{'Mitsui & Co':['Mitsubishi Corporation','Itochu','Sumitomo Corporation','Marubeni','Sojitz','Toyota Tsusho'],'Mitsubishi Corporation':['Mitsui & Co','Itochu','Sumitomo Corporation','Marubeni']},'diversified conglomerate':{'Mitsui & Co':['Mitsubishi Corporation','Itochu Corporation','Sumitomo Corporation','Marubeni Corporation','Sojitz','Toyota Tsusho'],'Mitsui & Co.':['Mitsubishi Corporation','Itochu Corporation','Sumitomo Corporation','Marubeni Corporation','Sojitz','Toyota Tsusho']},finance:{'Goldman Sachs':['Morgan Stanley','JPMorgan','Bank of America','Citigroup','Barclays','Deutsche Bank'],'JPMorgan':['Bank of America','Citigroup','Wells Fargo','Goldman Sachs','Morgan Stanley']},technology:{'OpenAI':['Anthropic','Google DeepMind','Microsoft','Meta AI','Cohere','Stability AI','Midjourney'],'Microsoft':['Google','Amazon','Apple','Meta','Oracle','Salesforce','IBM'],'Palantir':['Snowflake','Databricks','C3.ai','SAS','IBM','Oracle','Splunk']}};// Check if we have specific competitors for this company\nconst industryCompetitors=competitorMap[normalizedIndustry]||{};const specificCompetitors=industryCompetitors[companyName];if(specificCompetitors){return specificCompetitors.slice(0,8);}// Use Claude to discover competitors if not in our map\nreturn await this.discoverCompetitorsWithClaude(companyName,industry);}/**\n   * Map REAL stakeholders for the company\n   */async mapRealStakeholders(companyName,industry){const stakeholders={investors:[],customers:[],partners:[],regulators:[],analysts:[],media:[]};// Industry-specific stakeholders\nif(industry==='automotive'){stakeholders.regulators=['NHTSA','EPA','CARB','EU Commission','METI (Japan)'];stakeholders.analysts=['Cox Automotive','JD Power','IHS Markit','Bloomberg Intelligence'];stakeholders.media=['Automotive News','Car and Driver','Motor Trend','Electrek'];}else if(industry==='finance'||industry==='trading'){stakeholders.regulators=['SEC','FINRA','Federal Reserve','FSA (Japan)','FCA (UK)'];stakeholders.analysts=['Moody\\'s','S&P Global','Fitch Ratings','Bloomberg'];stakeholders.media=['Wall Street Journal','Financial Times','Bloomberg','Reuters'];}else if(industry==='technology'){stakeholders.regulators=['FTC','EU Commission','FCC','Data Protection Authorities'];stakeholders.analysts=['Gartner','Forrester','IDC','CB Insights'];stakeholders.media=['TechCrunch','The Verge','Wired','Ars Technica','The Information'];}return stakeholders;}/**\n   * Identify topics that actually matter for this company\n   */async identifyRelevantTopics(companyAnalysis){const topics=[];// Industry-specific topics\nconst industryTopics={automotive:['Electric vehicle adoption','Autonomous driving regulations','Battery technology advances','Supply chain resilience','Charging infrastructure'],finance:['Interest rate changes','Regulatory compliance','Digital banking trends','Cryptocurrency regulation','ESG investing'],technology:['AI regulation','Data privacy laws','Antitrust scrutiny','Cybersecurity threats','Open source trends']};// Add industry-specific topics\nconst industrySpecific=industryTopics[companyAnalysis.industry]||[];topics.push(...industrySpecific);// Add stage-specific topics\nif(companyAnalysis.company_stage==='startup'){topics.push('Funding rounds','Talent acquisition','Product-market fit');}else if(companyAnalysis.company_stage==='enterprise'){topics.push('Market consolidation','Shareholder activism','Executive changes');}return topics;}/**\n   * Generate smart keywords for monitoring\n   */async generateSmartKeywords(companyName,analysis){const keywords=[companyName];// Add variations of company name\nif(companyName.includes('&')){keywords.push(companyName.replace('&','and'));}// Add ticker symbol if public company\nif(analysis.ticker){keywords.push(\"$\".concat(analysis.ticker));}// Add key products\nif(analysis.key_products){keywords.push(...analysis.key_products.slice(0,3));}// Add CEO/founder name if known\nif(analysis.key_executives){keywords.push(...analysis.key_executives.slice(0,2));}return[...new Set(keywords)];}/**\n   * Create a monitoring strategy based on discovery\n   */createMonitoringStrategy(analysis){return{focus_areas:this.determineFocusAreas(analysis),alert_triggers:this.defineAlertTriggers(analysis),opportunity_patterns:this.identifyOpportunityPatterns(analysis),risk_indicators:this.identifyRiskIndicators(analysis)};}determineFocusAreas(analysis){const areas=[];if(analysis.market_position==='leader'){areas.push('Defend market position','Innovation leadership','Talent retention');}else if(analysis.market_position==='challenger'){areas.push('Competitive differentiation','Market share gains','Disruptive messaging');}else if(analysis.market_position==='emerging'){areas.push('Brand awareness','Funding news','Partnership opportunities');}return areas;}defineAlertTriggers(analysis){return['Competitor major announcement','Regulatory change in '+analysis.industry,'Market disruption event','Leadership changes at competitors','Industry consolidation moves'];}identifyOpportunityPatterns(analysis){return['Competitor crisis or scandal','Industry award deadlines','Speaking opportunity at conferences','Trending topic alignment','Partnership announcements'];}identifyRiskIndicators(analysis){return['Negative sentiment surge','Regulatory investigation news','Competitor aggressive moves','Economic downturn signals','Technology disruption threats'];}/**\n   * Use Claude to discover competitors when not in our database\n   */async discoverCompetitorsWithClaude(companyName,industry){const prompt=\"\\n      List the top 8 direct competitors of \".concat(companyName,\" in the \").concat(industry,\" industry.\\n      Return ONLY company names, no descriptions.\\n      Focus on actual competitors they compete with for customers.\\n      Format: Return as a JSON array of strings.\\n    \");try{const response=await fetch(\"\".concat(this.supabaseUrl,\"/functions/v1/claude-intelligence-synthesizer-v2\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(this.supabaseKey)},body:JSON.stringify({intelligence_type:'competitor_discovery',prompt:prompt,organization:{name:companyName,industry:industry}})});if(response.ok){const data=await response.json();return data.competitors||[];}}catch(error){console.error('Competitor discovery failed:',error);}return[];}/**\n   * Fallback discovery when APIs fail\n   */getFallbackDiscovery(companyName){return{company:{name:companyName,industry:'technology',description:'Company in the technology sector'},competitors:[],stakeholders:{regulators:['FTC','SEC'],media:['TechCrunch','WSJ'],analysts:['Gartner','Forrester']},topics:['Industry trends','Market dynamics'],keywords:[companyName],monitoring_strategy:{focus_areas:['Brand awareness','Competitive position'],alert_triggers:['Major announcements','Market changes']}};}/**\n   * Default analysis structure\n   */getDefaultAnalysis(companyName){return{industry:'technology',sub_industry:'software',business_model:'B2B SaaS',market_position:'emerging',key_products:[],target_customers:['Enterprises'],geographic_focus:'Global',company_stage:'growth',likely_pain_points:['Market competition','Talent acquisition'],description:\"\".concat(companyName,\" is a company in the technology sector\")};}}export default new IntelligentDiscoveryService();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}