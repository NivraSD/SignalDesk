{"ast":null,"code":"// RailwayActivity.js - Railway-style activity/feature list that expands to replace itself\nimport React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{useProject}from'../contexts/ProjectContext';import ContentGeneratorModule from'./ContentGeneratorModule';import API_BASE_URL from'../config/api';import{Bot,Brain,FileText,Users,TrendingUp,AlertTriangle,BarChart3,Archive,Send,ChevronLeft,ChevronRight,X,Sparkles,MessageSquare,Shield,Target,Menu,GripVertical,Maximize2,Minimize2,Move,GitBranch,Activity,Database,Circle,Square,ArrowLeft,Clock,Zap,Globe,Settings}from'lucide-react';import'./RailwayActivity.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const RailwayActivity=()=>{const{projectId}=useParams();const navigate=useNavigate();const{activeProject}=useProject();const messagesEndRef=useRef(null);// View state - either showing activity list or expanded feature\nconst[currentView,setCurrentView]=useState('activity');// 'activity' or 'feature'\nconst[selectedFeature,setSelectedFeature]=useState(null);const[isTransitioning,setIsTransitioning]=useState(false);// AI Assistant state - PRESERVING ALL FUNCTIONALITY\nconst[message,setMessage]=useState('');const[messages,setMessages]=useState([]);const[loading,setLoading]=useState(false);const[isEditingMode,setIsEditingMode]=useState(false);const[aiPanelOpen,setAiPanelOpen]=useState(true);// Content Generator state - PRESERVING ALL FUNCTIONALITY\nconst[generatedContent,setGeneratedContent]=useState('');const[currentContentType,setCurrentContentType]=useState(null);// Feature/Activity definitions\nconst activities=[{id:'content-generator',name:'Content Generator',icon:FileText,color:'#8b5cf6',description:'AI-powered content creation',status:'ready',stats:'12 pieces created today',component:ContentGeneratorModule,lastUsed:'2 minutes ago'},{id:'media-intelligence',name:'Media Intelligence',icon:Users,color:'#10b981',description:'Journalist discovery & outreach',status:'ready',stats:'234 journalists tracked',path:\"/projects/\".concat(projectId,\"/media-list\"),lastUsed:'1 hour ago'},{id:'campaign-intelligence',name:'Campaign Intelligence',icon:Brain,color:'#f59e0b',description:'Strategic campaign planning',status:'ready',stats:'3 active campaigns',path:\"/projects/\".concat(projectId,\"/campaign-intelligence-enhanced\"),lastUsed:'3 hours ago'},{id:'memory-vault',name:'Memory Vault',icon:Database,color:'#6366f1',description:'Project knowledge base',status:'ready',stats:'1,234 items stored',path:\"/projects/\".concat(projectId),lastUsed:'5 minutes ago'},{id:'stakeholder-intelligence',name:'Stakeholder Intelligence',icon:TrendingUp,color:'#ec4899',description:'Stakeholder monitoring',status:'building',stats:'56 stakeholders monitored',path:\"/projects/\".concat(projectId,\"/stakeholder-intelligence\"),lastUsed:'1 day ago'},{id:'crisis-command',name:'Crisis Command',icon:AlertTriangle,color:'#ef4444',description:'Crisis management center',status:'ready',stats:'No active crises',path:\"/projects/\".concat(projectId,\"/crisis-command\"),lastUsed:'2 days ago'},{id:'reports',name:'Reports & Analytics',icon:BarChart3,color:'#14b8a6',description:'Performance metrics & insights',status:'ready',stats:'5 reports generated',path:\"/projects/\".concat(projectId,\"/reports\"),lastUsed:'6 hours ago'}];// Initialize AI Assistant\nuseEffect(()=>{setMessages([{id:Date.now(),type:'assistant',content:'Welcome to SignalDesk! Select an activity from the list to get started. I\\'m here to help with any feature you choose.',timestamp:new Date()}]);},[]);// Handle activity/feature selection\nconst handleActivityClick=activity=>{if(activity.path&&!activity.component){// External route - navigate away\nnavigate(activity.path);return;}// Expand the feature in place\nsetIsTransitioning(true);setTimeout(()=>{setSelectedFeature(activity);setCurrentView('feature');setIsTransitioning(false);// Inform AI Assistant\nconst contextMsg={id:Date.now(),type:'system',content:\"Activated \".concat(activity.name,\". \").concat(activity.description),timestamp:new Date()};setMessages(prev=>[...prev,contextMsg]);},300);};// Handle back to activity list\nconst handleBackToActivities=()=>{setIsTransitioning(true);setTimeout(()=>{setCurrentView('activity');setSelectedFeature(null);setIsEditingMode(false);setGeneratedContent('');setIsTransitioning(false);},300);};// CRITICAL: Handle messages from Content Generator - EXACT RESTORATION\nconst handleContentGeneratorMessage=msg=>{console.log('RailwayActivity: Received message from ContentGenerator:',msg);if(msg.type==='edit_request'){setIsEditingMode(true);handleEditRequest(msg);}else if(msg.type==='user'&&msg.content){const userMsg={id:Date.now(),type:'user',content:msg.content,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);sendMessage(msg.content);}};// CRITICAL: Handle edit requests - EXACT RESTORATION\nconst handleEditRequest=async request=>{const{content:editPrompt,currentContent,metadata}=request;const userMsg={id:Date.now(),type:'user',content:\"Please edit this content: \\\"\".concat(editPrompt,\"\\\"\"),timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);setLoading(true);try{const response=await fetch(\"\".concat(API_BASE_URL,\"/ai/unified-chat\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({message:\"Edit the following content based on this request: \\\"\".concat(editPrompt,\"\\\"\\n\\nCurrent content:\\n\").concat(currentContent),mode:'content',context:{folder:'content-generator',editing:true,contentType:metadata===null||metadata===void 0?void 0:metadata.contentType,tone:metadata===null||metadata===void 0?void 0:metadata.tone}})});const data=await response.json();if(data.success){const aiMsg={id:Date.now(),type:'assistant',content:data.response,timestamp:new Date()};setMessages(prev=>[...prev,aiMsg]);setGeneratedContent(data.response);}}catch(error){console.error('Error processing edit:',error);const errorMsg={id:Date.now(),type:'error',content:'Failed to process edit request. Please try again.',timestamp:new Date()};setMessages(prev=>[...prev,errorMsg]);}finally{setLoading(false);}};// CRITICAL: Send message to AI - EXACT RESTORATION\nconst sendMessage=async text=>{if(!(text!==null&&text!==void 0&&text.trim()))return;setLoading(true);try{const isEditing=isEditingMode&&generatedContent;const response=await fetch(\"\".concat(API_BASE_URL,\"/ai/unified-chat\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({message:isEditing?\"Continue editing this content based on: \\\"\".concat(text,\"\\\"\\n\\nCurrent content:\\n\").concat(generatedContent):text,mode:(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='content-generator'?'content':'general',context:{folder:selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id,editing:isEditing}})});const data=await response.json();if(data.success){const aiMsg={id:Date.now(),type:'assistant',content:data.response,timestamp:new Date()};setMessages(prev=>[...prev,aiMsg]);// Check if content was generated\nif(isActualGeneratedContent(data.response)){setGeneratedContent(data.response);detectContentType(data.response);}}}catch(error){console.error('Error sending message:',error);const errorMsg={id:Date.now(),type:'error',content:'Failed to send message. Please check your connection.',timestamp:new Date()};setMessages(prev=>[...prev,errorMsg]);}finally{setLoading(false);}};// Handle form submission\nconst handleSubmit=e=>{e.preventDefault();if(!message.trim()||loading)return;const userMsg={id:Date.now(),type:'user',content:message,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);sendMessage(message);setMessage('');};// Check if response is actual generated content\nconst isActualGeneratedContent=text=>{if(!text||text.length<100)return false;const indicators=['FOR IMMEDIATE RELEASE','Dear ','Subject:','Q:','Question:','#','We are pleased'];return indicators.some(indicator=>text.includes(indicator));};// Detect content type\nconst detectContentType=text=>{if(text.includes('FOR IMMEDIATE RELEASE')){setCurrentContentType('press-release');}else if(text.includes('Q:')||text.includes('Question:')){setCurrentContentType('qa-doc');}else if(text.includes('#')){setCurrentContentType('social-post');}};// Update content from Content Generator\nconst handleContentUpdate=newContent=>{setGeneratedContent(newContent);if(newContent&&!isEditingMode){setIsEditingMode(false);}};// Auto-scroll messages\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);return/*#__PURE__*/_jsxs(\"div\",{className:\"railway-activity-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"railway-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"project-info\",children:[/*#__PURE__*/_jsx(\"h1\",{children:(activeProject===null||activeProject===void 0?void 0:activeProject.name)||'SignalDesk'}),/*#__PURE__*/_jsx(\"span\",{className:\"environment-badge\",children:\"Production\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-right\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"header-button\",children:[/*#__PURE__*/_jsx(Settings,{size:16}),\"Settings\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"header-button\",children:[/*#__PURE__*/_jsx(Globe,{size:16}),\"Deploy\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"railway-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ai-assistant-panel \".concat(aiPanelOpen?'open':'collapsed'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ai-panel-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ai-panel-title\",children:[/*#__PURE__*/_jsx(Bot,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:\"AI Assistant\"}),selectedFeature&&/*#__PURE__*/_jsxs(\"span\",{className:\"ai-mode-badge\",children:[selectedFeature.name,\" Mode\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAiPanelOpen(!aiPanelOpen),className:\"ai-toggle-button\",children:aiPanelOpen?/*#__PURE__*/_jsx(ChevronLeft,{size:16}):/*#__PURE__*/_jsx(ChevronRight,{size:16})})]}),aiPanelOpen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ai-messages\",children:[messages.map(msg=>/*#__PURE__*/_jsxs(\"div\",{className:\"ai-message \".concat(msg.type),children:[msg.type==='assistant'&&/*#__PURE__*/_jsx(Bot,{size:14,className:\"message-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:msg.content}),/*#__PURE__*/_jsx(\"span\",{className:\"message-time\",children:new Date(msg.timestamp).toLocaleTimeString()})]})]},msg.id)),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"ai-typing\",children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"ai-input-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:message,onChange:e=>setMessage(e.target.value),placeholder:isEditingMode?\"Continue editing...\":\"Ask me anything...\",disabled:loading,className:\"ai-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||!message.trim(),className:\"ai-send\",children:/*#__PURE__*/_jsx(Send,{size:16})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"center-panel \".concat(isTransitioning?'transitioning':''),children:currentView==='activity'?/*#__PURE__*/// Activity List View\n_jsxs(\"div\",{className:\"activity-list-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"activity-list-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Activities\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Select a feature to begin\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"activity-list\",children:activities.map(activity=>{const Icon=activity.icon;return/*#__PURE__*/_jsxs(\"div\",{className:\"activity-item \".concat(activity.status),onClick:()=>handleActivityClick(activity),children:[/*#__PURE__*/_jsx(\"div\",{className:\"activity-icon\",style:{backgroundColor:\"\".concat(activity.color,\"15\")},children:/*#__PURE__*/_jsx(Icon,{size:24,style:{color:activity.color}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"activity-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:activity.name}),/*#__PURE__*/_jsx(\"span\",{className:\"activity-status \".concat(activity.status),children:activity.status==='ready'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Circle,{size:8,fill:\"currentColor\"}),\" Ready\"]}):activity.status==='building'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Zap,{size:12}),\" Building\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Clock,{size:12}),\" Pending\"]})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"activity-description\",children:activity.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-footer\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"activity-stat\",children:activity.stats}),/*#__PURE__*/_jsx(\"span\",{className:\"activity-time\",children:activity.lastUsed})]})]}),/*#__PURE__*/_jsx(ChevronRight,{size:20,className:\"activity-arrow\"})]},activity.id);})})]}):/*#__PURE__*/// Expanded Feature View\n_jsxs(\"div\",{className:\"feature-expanded-view\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"feature-header\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleBackToActivities,className:\"back-button\",children:[/*#__PURE__*/_jsx(ArrowLeft,{size:20}),/*#__PURE__*/_jsx(\"span\",{children:\"Back to Activities\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"feature-title\",children:[selectedFeature&&/*#__PURE__*/React.createElement(selectedFeature.icon,{size:20,style:{color:selectedFeature.color}}),/*#__PURE__*/_jsx(\"h2\",{children:selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.name})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"feature-content\",children:(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='content-generator'&&/*#__PURE__*/_jsx(ContentGeneratorModule,{onAIMessage:handleContentGeneratorMessage,generatedContent:generatedContent,onContentUpdate:handleContentUpdate,currentContentType:currentContentType})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"right-info-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Project Stats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Total Activities\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:activities.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Active Features\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:activities.filter(a=>a.status==='ready').length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Last Deploy\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:\"2 hours ago\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Recent Activity\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"recent-list\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"recent-item\",children:[/*#__PURE__*/_jsx(Activity,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:\"Content generated\"}),/*#__PURE__*/_jsx(\"span\",{className:\"recent-time\",children:\"2m\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"recent-item\",children:[/*#__PURE__*/_jsx(Users,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:\"Media list updated\"}),/*#__PURE__*/_jsx(\"span\",{className:\"recent-time\",children:\"1h\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"recent-item\",children:[/*#__PURE__*/_jsx(Database,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:\"Memory saved\"}),/*#__PURE__*/_jsx(\"span\",{className:\"recent-time\",children:\"3h\"})]})]})]})]})]})]});};export default RailwayActivity;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}