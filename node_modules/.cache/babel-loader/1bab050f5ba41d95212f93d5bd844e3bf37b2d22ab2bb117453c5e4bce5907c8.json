{"ast":null,"code":"/**\n * Data Formatter Service\n * Single source of truth for formatting intelligence data for display\n */class DataFormatterService{/**\n   * Format orchestrator response for display\n   * This is the ONLY place where data should be transformed\n   */formatForDisplay(orchestratorResponse){var _intelligence$competi,_intelligence$key_ins;console.log('ðŸŽ¨ Formatting orchestrator response for display');const intelligence=orchestratorResponse.intelligence||{};const stats=orchestratorResponse.statistics||{};// Build properly formatted tabs\nconst formattedData={// Overview Tab - MUST have these exact fields\noverview:this.formatOverviewTab(intelligence),// Competition Tab\ncompetition:this.formatCompetitionTab(intelligence),// Stakeholders Tab\nstakeholders:this.formatStakeholdersTab(intelligence),// Topics Tab\ntopics:this.formatTopicsTab(intelligence),// Predictions Tab\npredictions:this.formatPredictionsTab(intelligence),// Tab format for display component\ntabs:{overview:this.formatOverviewTab(intelligence),competition:this.formatCompetitionTab(intelligence),stakeholders:this.formatStakeholdersTab(intelligence),topics:this.formatTopicsTab(intelligence),predictions:this.formatPredictionsTab(intelligence)},// Keep stats for reference\nstats:{competitors:((_intelligence$competi=intelligence.competitors)===null||_intelligence$competi===void 0?void 0:_intelligence$competi.length)||0,articles:stats.articles_processed||0,websites:stats.websites_scraped||0,sources:stats.sources_used||0,insights_stored:((_intelligence$key_ins=intelligence.key_insights)===null||_intelligence$key_ins===void 0?void 0:_intelligence$key_ins.length)||0},// Keep raw data for debugging\nraw:orchestratorResponse};console.log('âœ… Formatted data structure:',{hasOverview:!!formattedData.overview,overviewHasExecutiveSummary:!!formattedData.overview.executive_summary,executiveSummaryType:typeof formattedData.overview.executive_summary,tabKeys:Object.keys(formattedData.tabs)});return formattedData;}formatOverviewTab(intelligence){var _intelligence$synthes,_intelligence$synthes2,_intelligence$synthes3,_intelligence$synthes4,_intelligence$synthes5,_intelligence$synthes6,_intelligence$synthes7;// Extract PR strategy summary from synthesis\nlet executiveSummaryText='';// Check if we have rich synthesized analysis\nif((_intelligence$synthes=intelligence.synthesized)!==null&&_intelligence$synthes!==void 0&&_intelligence$synthes.pr_strategy_summary){executiveSummaryText=intelligence.synthesized.pr_strategy_summary;}else if((_intelligence$synthes2=intelligence.synthesized)!==null&&_intelligence$synthes2!==void 0&&_intelligence$synthes2.executive_summary){executiveSummaryText=intelligence.synthesized.executive_summary;}else if(typeof intelligence.executive_summary==='string'){executiveSummaryText=intelligence.executive_summary;}else{executiveSummaryText='Executive PR intelligence analysis in progress. Synthesizing insights from competitive landscape, stakeholder sentiment, media narratives, and predictive scenarios.';}return{executive_summary:executiveSummaryText,key_insights:this.extractArray(((_intelligence$synthes3=intelligence.synthesized)===null||_intelligence$synthes3===void 0?void 0:_intelligence$synthes3.key_insights)||intelligence.key_insights),critical_alerts:this.extractArray(((_intelligence$synthes4=intelligence.synthesized)===null||_intelligence$synthes4===void 0?void 0:_intelligence$synthes4.critical_alerts)||intelligence.alerts||intelligence.critical_alerts),recommended_actions:this.extractArray(((_intelligence$synthes5=intelligence.synthesized)===null||_intelligence$synthes5===void 0?void 0:_intelligence$synthes5.recommendations)||intelligence.recommendations),// Add second opinion if available\nalternative_perspective:((_intelligence$synthes6=intelligence.synthesized)===null||_intelligence$synthes6===void 0?void 0:(_intelligence$synthes7=_intelligence$synthes6.divergent_views)===null||_intelligence$synthes7===void 0?void 0:_intelligence$synthes7[0])||null};}formatCompetitionTab(intelligence){var _intelligence$synthes8;// Extract rich competitive analysis from synthesis\nconst competitiveData=((_intelligence$synthes8=intelligence.synthesized)===null||_intelligence$synthes8===void 0?void 0:_intelligence$synthes8.competitive_analysis)||{};// Build competitor profiles\nconst competitorProfiles={};if(intelligence.competitors&&Array.isArray(intelligence.competitors)){intelligence.competitors.forEach(comp=>{const name=typeof comp==='string'?comp:comp.name;if(name){competitorProfiles[name]={threat_level:comp.threat_level||'medium',market_position:comp.market_position||{position:'competitive'},latest_developments:comp.developments||competitiveData.competitor_moves||[],opportunities:comp.opportunities||[]};}});}return{competitive_landscape:{summary:competitiveData.landscape_summary||intelligence.competitive_landscape_summary||'Analyzing competitive dynamics and PR positioning opportunities',competitor_profiles:competitorProfiles,opportunities:this.extractArray(competitiveData.positioning_opportunities||intelligence.competitive_opportunities),threats:this.extractArray(competitiveData.reputation_threats),second_opinion:competitiveData.second_opinion}};}formatStakeholdersTab(intelligence){var _intelligence$synthes9;const stakeholderData=((_intelligence$synthes9=intelligence.synthesized)===null||_intelligence$synthes9===void 0?void 0:_intelligence$synthes9.stakeholder_analysis)||{};const defaultGroups=['investors','customers','employees','media','regulators'];return{sentiment_overview:stakeholderData.sentiment_overview||'Analyzing stakeholder sentiment and engagement priorities',groups:intelligence.stakeholder_groups||defaultGroups,group_priorities:stakeholderData.group_priorities||{},sentiment:stakeholderData.sentiment||intelligence.stakeholder_sentiment||{},concerns:this.extractArray(stakeholderData.concerns||intelligence.stakeholder_concerns||intelligence.alerts),engagement_strategy:this.extractArray(stakeholderData.engagement_strategy),messaging_frameworks:stakeholderData.messaging_frameworks||{},second_opinion:stakeholderData.second_opinion};}formatTopicsTab(intelligence){var _intelligence$synthes0;const narrativeData=((_intelligence$synthes0=intelligence.synthesized)===null||_intelligence$synthes0===void 0?void 0:_intelligence$synthes0.narrative_analysis)||{};return{trending_overview:narrativeData.trending_overview||'Analyzing media narratives and content opportunities',trending_topics:this.extractArray(intelligence.industry_trends||intelligence.trending_topics),media_coverage:this.extractArray(intelligence.breaking_news||intelligence.media_coverage),narrative_opportunities:this.extractArray(narrativeData.narrative_opportunities),content_angles:this.extractArray(narrativeData.content_angles),media_risks:this.extractArray(narrativeData.media_risks),sentiment_analysis:intelligence.sentiment_analysis||{},key_narratives:this.extractArray(intelligence.discussions||intelligence.key_narratives),second_opinion:narrativeData.second_opinion};}formatPredictionsTab(intelligence){var _intelligence$synthes1;const predictiveData=((_intelligence$synthes1=intelligence.synthesized)===null||_intelligence$synthes1===void 0?void 0:_intelligence$synthes1.predictive_analysis)||{};return{scenario_overview:predictiveData.scenario_overview||'Analyzing future scenarios and cascade effects',likely_scenarios:this.extractArray(predictiveData.likely_scenarios||intelligence.predicted_scenarios),cascade_effects:this.extractArray(predictiveData.cascade_effects),proactive_strategies:this.extractArray(predictiveData.proactive_strategies),trends:this.extractArray(intelligence.industry_trends||intelligence.emerging_trends),timeline:this.extractArray(intelligence.timeline),confidence:intelligence.confidence_levels||{},second_opinion:predictiveData.second_opinion};}/**\n   * Helper to extract and clean arrays\n   */extractArray(data){if(!data)return[];if(Array.isArray(data))return data;if(typeof data==='string')return[data];return[];}}// Export singleton\nconst dataFormatterService=new DataFormatterService();export default dataFormatterService;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}