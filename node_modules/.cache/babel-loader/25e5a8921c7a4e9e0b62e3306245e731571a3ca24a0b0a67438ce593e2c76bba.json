{"ast":null,"code":"import _objectSpread from\"/Users/jonathanliebowitz/Desktop/SignalDesk/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{supabase}from'../../config/supabase';import{getUnifiedOrganization,getUnifiedOpportunityConfig}from'../../utils/unifiedDataLoader';import'./ModuleStyles.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OpportunityModule=_ref=>{let{organizationId}=_ref;const[activeTab,setActiveTab]=useState('queue');const[opportunities,setOpportunities]=useState([]);const[filters,setFilters]=useState({type:'all',minScore:0,status:'pending'});const[loading,setLoading]=useState(true);const[userConfig,setUserConfig]=useState(null);// Load configuration once on mount\nuseEffect(()=>{// Use unified data loaders for consistency\nconst configToUse=getUnifiedOpportunityConfig();console.log('ðŸ“Š Opportunity Module loaded unified config:',configToUse);setUserConfig(configToUse);},[]);// Load opportunities when config and organizationId are ready\nuseEffect(()=>{if(organizationId&&userConfig){loadOpportunities();}},[organizationId,filters,userConfig]);const loadOpportunities=async()=>{setLoading(true);try{// Get the actual organization data, not just the ID\nconst orgData=getUnifiedOrganization();// First try the new Opportunity Orchestrator (follows Intelligence Hub pattern)\nif(orgData&&orgData.name){try{console.log('ðŸŽ¯ Calling opportunity-orchestrator with org:',orgData.name);console.log('ðŸ“‹ Using configuration:',userConfig);// Try the orchestrated approach first\nconst{data:orchestratedData,error:orchestratedError}=await supabase.functions.invoke('opportunity-orchestrator',{body:{organization:{name:orgData.name,// Use actual organization name\nindustry:orgData.industry||(userConfig===null||userConfig===void 0?void 0:userConfig.industry)||'technology'},config:userConfig,forceRefresh:false}});if(!orchestratedError&&orchestratedData!==null&&orchestratedData!==void 0&&orchestratedData.success&&orchestratedData!==null&&orchestratedData!==void 0&&orchestratedData.opportunities){console.log('âœ… Orchestrator succeeded with',orchestratedData.opportunities.length,'opportunities');console.log('ðŸŽ­ Personas used:',orchestratedData.personas_used);try{// Process orchestrated opportunities\nconsole.log('ðŸ“¦ Processing opportunities...');const scoredOpportunities=orchestratedData.opportunities.map(opp=>_objectSpread(_objectSpread({},opp),{},{priority_score:opp.priority_score||opp.confidence||75,configured_weight:50,// Simplified - removed problematic userConfig access\nstatus:opp.status||'pending',// Ensure status field exists\nopportunity_data:{description:opp.description||opp.action||''}}));console.log('âœ… Scored opportunities:',scoredOpportunities.length);// Apply local filters\nconst filtered=scoredOpportunities.filter(opp=>{if(filters.type!=='all'&&opp.opportunity_type!==filters.type)return false;if(opp.priority_score<filters.minScore)return false;if(filters.status!=='all'&&opp.status!==filters.status)return false;return true;});console.log('âœ… Filtered opportunities:',filtered.length);filtered.sort((a,b)=>b.priority_score-a.priority_score);setOpportunities(filtered);console.log('âœ… Set opportunities in state');setLoading(false);return;}catch(processingError){console.error('âŒ Error processing opportunities:',processingError);setOpportunities([]);setLoading(false);return;}}}catch(orchestratorError){console.warn('Orchestrator not available, trying simple assessment:',orchestratorError);}// Fallback to simple assessment if orchestrator fails\ntry{console.log('ðŸŽ¯ Falling back to assess-opportunities-simple');const{data,error}=await supabase.functions.invoke('assess-opportunities-simple',{body:{organizationId,forceRefresh:false,organizationProfile:userConfig}});console.log('ðŸ“Š Simple assessment response:',{data,error});if(error){console.error('âŒ Edge Function error:',error);}if(!error&&data&&data.opportunities&&Array.isArray(data.opportunities)){// Process opportunities from Edge Function\nconst scoredOpportunities=data.opportunities.map(opp=>{var _userConfig$opp$oppor;return _objectSpread(_objectSpread({},opp),{},{priority_score:opp.adjusted_score||opp.score||opp.base_score,configured_weight:(userConfig===null||userConfig===void 0?void 0:(_userConfig$opp$oppor=userConfig[opp.opportunity_type])===null||_userConfig$opp$oppor===void 0?void 0:_userConfig$opp$oppor.weight)||50,opportunity_data:{description:opp.description||opp.suggested_action||''}});});// Apply local filters\nconst filtered=scoredOpportunities.filter(opp=>{if(filters.type!=='all'&&opp.opportunity_type!==filters.type)return false;if(opp.priority_score<filters.minScore)return false;if(filters.status!=='all'&&opp.status!==filters.status)return false;return true;});filtered.sort((a,b)=>b.priority_score-a.priority_score);setOpportunities(filtered);setLoading(false);return;}}catch(edgeFunctionError){console.warn('Edge Function not available, using fallback:',edgeFunctionError);// Continue to fallback mock data\n}}// Fallback to mock data if Edge Function fails or no organizationId\nconst mockOpportunities=[{id:1,opportunity_type:'trending',title:'AI Ethics Discussion Trending',opportunity_data:{description:'Major tech conference next week focusing on AI ethics - perfect timing for thought leadership'},base_score:85,urgency:'high',window_end:new Date(Date.now()+48*60*60*1000).toISOString(),status:'pending'},{id:2,opportunity_type:'competitor_gap',title:'Competitor Vulnerability Detected',opportunity_data:{description:'Competitor facing criticism over data practices - opportunity to highlight our privacy-first approach'},base_score:78,urgency:'high',window_end:new Date(Date.now()+72*60*60*1000).toISOString(),status:'pending'},{id:3,opportunity_type:'news_hook',title:'Breaking: Industry Report Release',opportunity_data:{description:'Gartner releasing annual industry report - chance to provide expert commentary'},base_score:75,urgency:'medium',window_end:new Date(Date.now()+168*60*60*1000).toISOString(),status:'pending'},{id:4,opportunity_type:'journalist_interest',title:'WSJ Reporter Seeking Sources',opportunity_data:{description:'Wall Street Journal tech reporter looking for expert sources on enterprise AI adoption'},base_score:82,urgency:'high',window_end:new Date(Date.now()+24*60*60*1000).toISOString(),status:'pending'},{id:5,opportunity_type:'award',title:'Tech Innovation Awards Open',opportunity_data:{description:'Nominations open for annual tech innovation awards - deadline in 2 weeks'},base_score:65,urgency:'medium',window_end:new Date(Date.now()+14*24*60*60*1000).toISOString(),status:'pending'},{id:6,opportunity_type:'speaking',title:'Panel Opportunity: Future of Work',opportunity_data:{description:'Conference seeking panelists for Future of Work discussion next month'},base_score:70,urgency:'low',window_end:new Date(Date.now()+30*24*60*60*1000).toISOString(),status:'pending'},{id:7,opportunity_type:'editorial_calendar',title:'Q2 Tech Trends Feature',opportunity_data:{description:'TechCrunch planning Q2 trends roundup - accepting expert predictions'},base_score:68,urgency:'medium',window_end:new Date(Date.now()+7*24*60*60*1000).toISOString(),status:'pending'}];// Apply user configuration weights to mock data\nconst scoredOpportunities=mockOpportunities.map(opp=>{let finalScore=opp.base_score;let weight=100;// Check if opportunity type is enabled in config\nif(userConfig&&userConfig.opportunity_types){// Map old opportunity types to new config keys\nconst typeMapping={'trending':'narrative_vacuum','competitor_gap':'competitor_weakness','news_hook':'cascade_effect','journalist_interest':'narrative_vacuum','award':'alliance_opening','speaking':'alliance_opening','editorial_calendar':'narrative_vacuum'};const configKey=typeMapping[opp.opportunity_type]||opp.opportunity_type;if(userConfig.opportunity_types[configKey]===false){finalScore=0;weight=0;}}return _objectSpread(_objectSpread({},opp),{},{priority_score:finalScore,configured_weight:weight});});const minScore=(userConfig===null||userConfig===void 0?void 0:userConfig.minimum_confidence)||(userConfig===null||userConfig===void 0?void 0:userConfig.minimumScore)||0;const filtered=scoredOpportunities.filter(opp=>{// Filter out disabled opportunity types\nif(opp.priority_score===0)return false;if(filters.type!=='all'&&opp.opportunity_type!==filters.type)return false;if(opp.priority_score<filters.minScore||opp.priority_score<minScore)return false;if(filters.status!=='all'&&opp.status!==filters.status)return false;return true;});filtered.sort((a,b)=>b.priority_score-a.priority_score);setOpportunities(filtered);setLoading(false);}catch(error){console.error('Error loading opportunities:',error);setLoading(false);}};const calculateTimeWindow=opportunity=>{if(!opportunity.window_end)return'No deadline';const now=new Date();const end=new Date(opportunity.window_end);const hours=Math.floor((end-now)/(1000*60*60));if(hours<0)return'Expired';if(hours<24)return\"\".concat(hours,\" hours\");if(hours<168)return\"\".concat(Math.floor(hours/24),\" days\");return\"\".concat(Math.floor(hours/168),\" weeks\");};const getScoreColor=score=>{if(score>=80)return'#10B981';// Green\nif(score>=60)return'#F59E0B';// Orange\nif(score>=40)return'#3B82F6';// Blue\nreturn'#6B7280';// Gray\n};const renderOpportunityQueue=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"opportunity-queue\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"queue-filters\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"filter-select\",value:filters.type,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{type:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Types\"}),/*#__PURE__*/_jsx(\"option\",{value:\"trend\",children:\"Trending Topics\"}),/*#__PURE__*/_jsx(\"option\",{value:\"news\",children:\"News Events\"}),/*#__PURE__*/_jsx(\"option\",{value:\"competitor\",children:\"Competitor Moves\"}),/*#__PURE__*/_jsx(\"option\",{value:\"niv\",children:\"Strategic Insights\"}),/*#__PURE__*/_jsx(\"option\",{value:\"event\",children:\"Industry Events\"})]}),/*#__PURE__*/_jsxs(\"select\",{className:\"filter-select\",value:filters.minScore,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{minScore:parseInt(e.target.value)})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"0\",children:\"All Scores\"}),/*#__PURE__*/_jsx(\"option\",{value:\"60\",children:\"Score \\u2265 60\"}),/*#__PURE__*/_jsx(\"option\",{value:\"70\",children:\"Score \\u2265 70\"}),/*#__PURE__*/_jsx(\"option\",{value:\"80\",children:\"Score \\u2265 80\"}),/*#__PURE__*/_jsx(\"option\",{value:\"90\",children:\"Score \\u2265 90\"})]}),/*#__PURE__*/_jsxs(\"select\",{className:\"filter-select\",value:filters.status,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"in_progress\",children:\"In Progress\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Status\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"opportunities-list\",children:opportunities.length>0?opportunities.map(opp=>{var _opp$opportunity_data;return/*#__PURE__*/_jsxs(\"div\",{className:\"opportunity-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"opp-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"opp-type-badge\",children:opp.opportunity_type.replace('_',' ')}),/*#__PURE__*/_jsx(\"div\",{className:\"opp-time-window\",children:calculateTimeWindow(opp)}),userConfig&&userConfig[opp.opportunity_type]&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'10px',color:'#9CA3AF'},children:[\"Weight: \",opp.configured_weight,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"opp-content\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"opp-title\",children:opp.title||'Untitled Opportunity'}),/*#__PURE__*/_jsx(\"p\",{className:\"opp-description\",children:((_opp$opportunity_data=opp.opportunity_data)===null||_opp$opportunity_data===void 0?void 0:_opp$opportunity_data.description)||'No description available'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"opp-scores\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"score-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"score-label\",children:\"CRS\"}),/*#__PURE__*/_jsx(\"div\",{className:\"score-value\",style:{color:getScoreColor(opp.crs_score)},children:opp.crs_score||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"score-label\",children:\"NVS\"}),/*#__PURE__*/_jsx(\"div\",{className:\"score-value\",style:{color:getScoreColor(opp.nvs_score)},children:opp.nvs_score||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"score-label\",children:\"Priority\"}),/*#__PURE__*/_jsx(\"div\",{className:\"score-value\",style:{color:getScoreColor(opp.priority_score)},children:opp.priority_score||0})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"opp-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn primary\",children:\"Execute Campaign\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn secondary\",children:\"View Details\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn ghost\",children:\"Dismiss\"})]})]},opp.id);}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"No opportunities found\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Adjust your filters or wait for new opportunities to be detected\"})]})})]});const renderScoring=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"opportunity-scoring\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"section-title\",children:\"Scoring Configuration\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-sections\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"CRS (Content Relevance Score)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"scoring-description\",children:\"Measures how well an opportunity aligns with your brand narrative and current PR objectives\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-factors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Brand Alignment\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"40%\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Objective Match\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"30%\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Audience Relevance\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"30%\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"NVS (News Value Score)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"scoring-description\",children:\"Evaluates the newsworthiness and media appeal of an opportunity\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-factors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Timeliness\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"35%\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Impact\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"35%\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"factor\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"factor-name\",children:\"Uniqueness\"}),/*#__PURE__*/_jsx(\"span\",{className:\"factor-weight\",children:\"30%\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"scoring-card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Priority Score\"}),/*#__PURE__*/_jsx(\"p\",{className:\"scoring-description\",children:\"Combined score that factors in urgency, impact, and resource requirements\"}),/*#__PURE__*/_jsx(\"div\",{className:\"scoring-formula\",children:\"Priority = (CRS \\xD7 0.4) + (NVS \\xD7 0.4) + (Urgency \\xD7 0.2)\"})]})]})]});const renderPredictions=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"opportunity-predictions\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"section-title\",children:\"Opportunity Predictions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"predictions-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-icon\",children:\"\\uD83D\\uDCC8\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Upcoming Trends\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"AI Ethics Discussion\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"2-3 days\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Sustainability Reports\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"1 week\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Q1 Earnings Season\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"2 weeks\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-icon\",children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Competitor Actions\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Product Launch (Competitor A)\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"Next week\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Partnership Announcement\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"3-5 days\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-icon\",children:\"\\uD83D\\uDCF0\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Media Cycles\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Tech Innovation Focus\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"This week\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"prediction-name\",children:\"Industry Conference Coverage\"}),/*#__PURE__*/_jsx(\"span\",{className:\"prediction-eta\",children:\"10 days\"})]})]})]})]})]});if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"module-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading Opportunities...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"opportunity-module\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"module-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"module-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"module-icon\",children:\"\\uD83C\\uDFAF\"}),\"Opportunity Engine\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"module-tabs\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"tab \".concat(activeTab==='queue'?'active':''),onClick:()=>setActiveTab('queue'),children:\"Queue\"}),/*#__PURE__*/_jsx(\"button\",{className:\"tab \".concat(activeTab==='scoring'?'active':''),onClick:()=>setActiveTab('scoring'),children:\"Scoring\"}),/*#__PURE__*/_jsx(\"button\",{className:\"tab \".concat(activeTab==='predictions'?'active':''),onClick:()=>setActiveTab('predictions'),children:\"Predictions\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"module-body\",children:[activeTab==='queue'&&renderOpportunityQueue(),activeTab==='scoring'&&renderScoring(),activeTab==='predictions'&&renderPredictions()]})]});};export default OpportunityModule;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}