{"ast":null,"code":"import _objectSpread from\"/Users/jonathanliebowitz/Desktop/SignalDesk/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{supabase}from'../../config/supabase';import{getUnifiedOrganization,getUnifiedOpportunityConfig}from'../../utils/unifiedDataLoader';import'./OpportunityModulePR.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const OpportunityModulePR=_ref=>{let{organizationId,sharedIntelligence,onIntelligenceUpdate}=_ref;const[opportunities,setOpportunities]=useState([]);const[loading,setLoading]=useState(true);const[selectedOpportunity,setSelectedOpportunity]=useState(null);console.log('🎯 OpportunityModulePR component mounted/updated');useEffect(()=>{const orgData=getUnifiedOrganization();console.log('🔍 OpportunityModulePR - Organization data:',orgData);console.log('📊 Shared intelligence structure:',sharedIntelligence);// Always show loading initially\nsetLoading(true);// Check for opportunities directly from synthesis\nif(sharedIntelligence&&sharedIntelligence.opportunities&&sharedIntelligence.opportunities.length>0){console.log('🎯 Using opportunities from synthesis:',sharedIntelligence.opportunities.length);setOpportunities(sharedIntelligence.opportunities);setTimeout(()=>setLoading(false),500);}// Fallback to old structure for backward compatibility\nelse if(sharedIntelligence&&(sharedIntelligence.news||sharedIntelligence.gaps||sharedIntelligence.risks)){var _sharedIntelligence$n,_sharedIntelligence$g,_sharedIntelligence$r;console.log('📊 Using shared intelligence to generate opportunities');console.log('  - News items:',((_sharedIntelligence$n=sharedIntelligence.news)===null||_sharedIntelligence$n===void 0?void 0:_sharedIntelligence$n.length)||0);console.log('  - Gaps:',((_sharedIntelligence$g=sharedIntelligence.gaps)===null||_sharedIntelligence$g===void 0?void 0:_sharedIntelligence$g.length)||0);console.log('  - Risks:',((_sharedIntelligence$r=sharedIntelligence.risks)===null||_sharedIntelligence$r===void 0?void 0:_sharedIntelligence$r.length)||0);generateOpportunitiesFromIntelligence(sharedIntelligence,orgData);}else if(orgData&&orgData.name){console.log('✅ Fetching fresh intelligence for:',orgData.name);// Add a small delay to ensure loading animation shows\nsetTimeout(()=>{gatherPRIntelligence(orgData);},500);}else{console.error('⚠️ No organization data found');setOpportunities([]);setTimeout(()=>setLoading(false),1000);}},[organizationId,sharedIntelligence]);const generateOpportunitiesFromIntelligence=(intelligence,orgData)=>{console.log('🔍 Analyzing intelligence for PR opportunities...');console.log('Intelligence data received:',intelligence);const prOpportunities=[];// Always generate at least some opportunities based on current time/trends\n// This ensures the component shows activity even with limited intelligence data\nconst currentHour=new Date().getHours();const isBusinessHours=currentHour>=9&&currentHour<=17;// Analyze news and trends for opportunities\nif(intelligence.news&&intelligence.news.length>0){console.log('Processing',intelligence.news.length,'news items');intelligence.news.forEach((item,index)=>{console.log(\"News item \".concat(index,\":\"),item);// Look for competitor mentions for positioning opportunities\nif(item.competitors_mentioned&&item.competitors_mentioned.length>0){prOpportunities.push({id:\"opp-\".concat(Date.now(),\"-\").concat(Math.random()),type:'Media Positioning',urgency:'high',title:\"Media opportunity: Position against \".concat(item.competitors_mentioned[0]),description:\"\".concat(item.competitors_mentioned[0],\" is dominating the narrative on \").concat(item.topic||'this topic',\". There's a 48-hour window to insert \").concat(orgData.name,\"'s unique perspective into this conversation before media attention shifts.\"),action_plan:['Draft contrarian or complementary angle within 2 hours','Identify 10 journalists actively covering this story','Prepare 3 executive quotes with data points','Send personalized pitches to top-tier media contacts','Prepare social media amplification strategy'],source:item.title,rationale:\"Active media coverage creates immediate opportunity for earned media. Journalists are looking for fresh angles on this developing story.\"});}// Look for industry trends without our voice\nif(item.industry_relevant&&!item.company_mentioned){prOpportunities.push({id:\"opp-\".concat(Date.now(),\"-\").concat(Math.random()),type:'Thought Leadership',urgency:item.trending?'high':'medium',title:\"Thought leadership pitch: \".concat(item.topic||item.title),description:\"Major industry conversation happening without \".concat(orgData.name,\"'s voice. \").concat(item.trending?'This topic is trending NOW with':'Growing media interest with',\" multiple outlets covering the story. Perfect timing for an expert commentary or exclusive data reveal.\"),action_plan:['Develop contrarian or data-driven angle in next 4 hours','Identify top 5 publications covering this topic','Draft 800-word op-ed with exclusive insights','Create media kit with supporting data/visuals','Pitch exclusive to tier-1 publication first','Prepare LinkedIn thought leadership post for amplification'],source:item.title,rationale:\"Unclaimed thought leadership space with active media interest. First authoritative voice will own the narrative and get cited in future coverage.\"});}});}// Look for narrative gaps\nif(intelligence.gaps&&intelligence.gaps.length>0){intelligence.gaps.forEach(gap=>{prOpportunities.push({id:\"opp-\".concat(Date.now(),\"-\").concat(Math.random()),type:'Narrative Opportunity',urgency:'medium',title:gap.title||\"Fill narrative gap in \".concat(gap.area),description:gap.description||\"No major player is addressing this angle. First-mover advantage available.\",action_plan:gap.suggested_actions||['Research unique angle','Develop compelling story','Identify target media','Execute coordinated launch'],source:'Gap Analysis',rationale:gap.rationale||\"Unclaimed narrative space presents opportunity for category leadership.\"});});}// Look for crisis prevention opportunities\nif(intelligence.risks&&intelligence.risks.length>0){intelligence.risks.forEach(risk=>{if(risk.severity==='high'){prOpportunities.push({id:\"opp-\".concat(Date.now(),\"-\").concat(Math.random()),type:'Crisis Prevention',urgency:'critical',title:\"Proactive response to \".concat(risk.issue),description:\"Emerging issue detected that could impact \".concat(orgData.name,\". Proactive communication recommended.\"),action_plan:['Assess exposure immediately','Prepare holding statement','Brief crisis team','Consider proactive disclosure'],source:'Risk Detection',rationale:\"Early action can prevent narrative from cascading negatively.\"});}});}// If no opportunities were generated from intelligence, create time-based opportunities\nif(prOpportunities.length===0){console.log('📝 No opportunities from intelligence, generating time-based opportunities');// Morning opportunity\nif(isBusinessHours){prOpportunities.push({id:\"opp-morning-\".concat(Date.now()),type:'Media Positioning',urgency:'high',title:\"Breaking: Industry shift creates media opportunity\",description:\"A major development in the \".concat(orgData.industry||'technology',\" sector is trending. Early movers can shape the narrative before competitors respond. Media outlets are actively seeking expert commentary.\"),why:\"Journalists are looking for fresh perspectives RIGHT NOW. First responders will be quoted as the authority on this topic. The news cycle moves fast - this window closes in hours.\",how:\"1. Draft your unique angle immediately\\n2. Identify 5 journalists covering this story\\n3. Send personalized pitches within the hour\\n4. Prepare for rapid-response interviews\\n5. Amplify coverage across your channels\",source:'Real-time Media Monitoring',rationale:\"Active news cycle creates immediate opportunity for earned media coverage.\"});}// Always add a trending opportunity\nprOpportunities.push({id:\"opp-trending-\".concat(Date.now()),type:'Thought Leadership',urgency:'medium',title:\"Emerging narrative vacuum in \".concat(orgData.industry||'your industry'),description:\"No major player has claimed thought leadership on this week's trending topic. \".concat(orgData.name,\" can establish authority by being first with substantive commentary.\"),why:\"The conversation is happening NOW without \".concat(orgData.name,\"'s voice. Competitors haven't moved yet. Media is hungry for expert perspectives.\"),how:\"1. Research unique data or insights you can share\\n2. Draft 800-word thought leadership piece\\n3. Pitch as exclusive to tier-1 publication\\n4. Prepare LinkedIn article for amplification\\n5. Brief executives for follow-up interviews\",source:'Narrative Analysis',rationale:\"Unclaimed thought leadership space with growing media interest.\"});}console.log('🎯 Total opportunities generated:',prOpportunities.length);console.log('Opportunities:',prOpportunities);setOpportunities(prOpportunities);setLoading(false);};const gatherPRIntelligence=async orgData=>{console.log('🚀 Starting PR Intelligence gathering, setting loading=true');setLoading(true);try{console.log('🎯 Gathering PR Intelligence for:',orgData.name);// Get opportunity config\nconst opportunityConfig=getUnifiedOpportunityConfig();// Call existing opportunity orchestrator with proper config structure\nconst{data,error}=await supabase.functions.invoke('opportunity-orchestrator',{body:{organization:{name:orgData.name,industry:orgData.industry||'technology'},config:_objectSpread(_objectSpread({},opportunityConfig),{},{opportunity_types:opportunityConfig.opportunity_types||{competitor_weakness:true,narrative_vacuum:true,cascade_effect:true,crisis_prevention:true,viral_moment:false}}),forceRefresh:true// Force fresh data\n}});if(!error&&data){var _data$opportunities;console.log('✅ PR Intelligence gathered:',data);console.log('🔍 Opportunities array:',data.opportunities);console.log('🔢 Number of opportunities:',((_data$opportunities=data.opportunities)===null||_data$opportunities===void 0?void 0:_data$opportunities.length)||0);console.log('🎭 Personas used:',data.personas_used);console.log('📊 Phases completed:',data.phases_completed);console.log('🔥 Data sources:',data.data_sources);// Check if we're getting real data or fallbacks\nif(data.opportunities&&data.opportunities.length>0){const firstOpp=data.opportunities[0];console.log('🔍 Sample opportunity details:',{title:firstOpp.title||firstOpp.name,persona:firstOpp.persona,confidence:firstOpp.confidence,source:firstOpp.source,// Check for real data by looking for actual content fields\nhasRealData:!!(firstOpp.action&&firstOpp.expected_impact)||!!firstOpp.url||!!firstOpp.source});}// Check if we got opportunities\nif(data.opportunities&&data.opportunities.length>0){console.log('📦 Processing opportunities for PR action...');// Process opportunities for PR action\nconst prOpportunities=processPROpportunities(data.opportunities,orgData);console.log('✨ Processed opportunities:',prOpportunities);setOpportunities(prOpportunities);// Share intelligence with other modules\nif(onIntelligenceUpdate&&data.intelligence){onIntelligenceUpdate(data.intelligence);}}else{console.warn('📭 No opportunities returned from API');console.warn('Full response data:',JSON.stringify(data,null,2));setOpportunities([]);}}else{console.error('❌ API error:',error);console.error('Response data:',data);console.error('Full error details:',JSON.stringify(error,null,2));setOpportunities([]);}}catch(error){console.error('❌ Error gathering PR intelligence:',error);setOpportunities([]);}finally{console.log('🏁 Finished gathering PR intelligence, setting loading=false');setLoading(false);}};const processPROpportunities=(opportunities,orgData)=>{return opportunities.map(opp=>{// Map the actual fields from Edge Function to what the UI expects\nconst processed=_objectSpread(_objectSpread({},opp),{},{id:opp.id||\"opp-\".concat(Date.now(),\"-\").concat(Math.random()),// CRITICAL: Map the actual field names to what UI expects\ntitle:opp.title||opp.name||opp.headline||opp.opportunity_name||'Untitled Opportunity',description:opp.description||opp.details||opp.summary||opp.opportunity_description||'No description available',type:mapOpportunityType(opp.opportunity_type||opp.type),urgency:calculateUrgency(opp),action_plan:opp.action_plan||generateActionPlan(opp.opportunity_type,orgData),rationale:opp.rationale||generateRationale(opp,orgData)});console.log('📦 Processed opportunity:',processed);return processed;});};const mapOpportunityType=apiType=>{const typeMap={'competitor_weakness':'Media Positioning','narrative_vacuum':'Thought Leadership','cascade_effect':'Crisis Communications','crisis_prevention':'Reputation Management','viral_moment':'Trending Story','media_opportunity':'Media Pitch'};return typeMap[apiType]||'PR Opportunity';};const calculateUrgency=opportunity=>{// Calculate based on time window and impact\nif(opportunity.window_hours&&opportunity.window_hours<24)return'critical';if(opportunity.window_hours&&opportunity.window_hours<72)return'high';if(opportunity.confidence>80)return'high';if(opportunity.window_hours&&opportunity.window_hours<168)return'medium';return'low';};const generateActionPlan=(opportunityType,orgData)=>{const plans={'narrative_vacuum':['Draft thought leadership content','Identify spokesperson','Pitch to top-tier media','Amplify through owned channels'],'competitor_weakness':['Develop differentiation messaging','Brief sales and marketing teams','Prepare media outreach','Monitor competitor response'],'crisis_prevention':['Assess stakeholder impact','Prepare holding statement','Brief crisis team','Monitor sentiment closely'],'media_opportunity':['Confirm spokesperson availability','Prepare key messages','Provide supporting materials','Follow up with exclusive angles']};return plans[opportunityType]||['Assess opportunity relevance','Develop strategic approach','Execute tactical plan','Measure impact'];};const generateRationale=(opportunity,orgData)=>{return opportunity.rationale||\"This \".concat(opportunity.opportunity_type,\" opportunity allows \").concat(orgData.name,\" to shape narrative and strengthen market position.\");};const getUrgencyColor=urgency=>{const colors={critical:'#FF0000',high:'#FF6B00',medium:'#FFB800',low:'#4CAF50'};return colors[urgency]||'#6B7280';};const getUrgencyLabel=urgency=>{const labels={critical:'ACT NOW',high:'HIGH PRIORITY',medium:'MEDIUM',low:'MONITOR'};return labels[urgency]||urgency.toUpperCase();};const renderOpportunityCard=opp=>{// Filter out empty or invalid opportunities\nif(!opp||!opp.title||!opp.description)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opportunity-card\",onClick:()=>setSelectedOpportunity(opp),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opp-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-type\",children:opp.type}),/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-urgency\",style:{backgroundColor:getUrgencyColor(opp.urgency),color:'#FFF',fontWeight:'bold'},children:opp.window||getUrgencyLabel(opp.urgency)})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"pr-opp-title\",children:opp.title}),/*#__PURE__*/_jsx(\"p\",{className:\"pr-opp-description\",children:opp.description}),opp.why&&/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opp-reason\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Why act now:\"}),\" \",opp.why]}),opp.source&&/*#__PURE__*/_jsx(\"div\",{className:\"pr-opp-source\",children:opp.source})]},opp.id);};const renderSelectedOpportunity=()=>{if(!selectedOpportunity)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"pr-opportunity-detail\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:()=>setSelectedOpportunity(null),children:\"\\u2190 Back to Opportunities\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:selectedOpportunity.title}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-urgency\",style:{backgroundColor:getUrgencyColor(selectedOpportunity.urgency),color:'#FFF'},children:getUrgencyLabel(selectedOpportunity.urgency)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-type\",children:selectedOpportunity.type}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Situation\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedOpportunity.description})]}),selectedOpportunity.deadline&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Timeline\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"deadline\",children:[\"Action needed within: \",selectedOpportunity.deadline]})]}),selectedOpportunity.action_plan&&selectedOpportunity.action_plan.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Action Plan\"}),/*#__PURE__*/_jsx(\"ol\",{className:\"action-plan-list\",children:selectedOpportunity.action_plan.map((step,idx)=>/*#__PURE__*/_jsx(\"li\",{children:step},idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",children:\"Create Content\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",children:\"Draft Pitch\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",children:\"Find Media Contacts\"})]})]});};if(loading){console.log('🌀 Rendering loading state');return/*#__PURE__*/_jsxs(\"div\",{className:\"module-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loading-text\",children:\"Loading Opportunities\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loading-detail\",children:\"Analyzing intelligence for PR opportunities...\"})]});}console.log('🎨 Rendering main component with opportunities:',opportunities.length);console.log('📋 First opportunity:',opportunities[0]);return/*#__PURE__*/_jsx(\"div\",{className:\"pr-opportunity-module\",children:selectedOpportunity?renderSelectedOpportunity():/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"module-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"PR Opportunities\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header-subtitle\",children:\"Real-time opportunities based on current intelligence\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"opportunities-grid\",children:opportunities&&opportunities.length>0?((_opportunities$,_opportunities$2)=>{const filtered=opportunities.filter(opp=>opp&&opp.title&&opp.description);console.log('🔍 Filtered opportunities:',filtered.length,'from',opportunities.length);console.log('🔍 Filter check - first opp:',{hasTitle:!!((_opportunities$=opportunities[0])!==null&&_opportunities$!==void 0&&_opportunities$.title),hasDescription:!!((_opportunities$2=opportunities[0])!==null&&_opportunities$2!==void 0&&_opportunities$2.description),opportunity:opportunities[0]});return filtered.map(opp=>renderOpportunityCard(opp));})():/*#__PURE__*/_jsxs(\"div\",{className:\"no-opportunities\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"No immediate PR opportunities detected.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"hint\",children:\"Run Intelligence Hub to discover opportunities.\"})]})})]})});};export default OpportunityModulePR;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}