<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Claude Edge Function</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f1f1f1;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Claude Edge Function</h1>
        
        <div class="test-section">
            <h2>Test 1: Organization Enhancement</h2>
            <p>Test if Claude can enhance Toyota organization data with automotive competitors</p>
            <button onclick="testEnhancement()">Run Enhancement Test</button>
            <div id="enhancement-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Competitor Synthesis</h2>
            <p>Test if Claude can synthesize competitive intelligence with proper data</p>
            <button onclick="testSynthesis()">Run Synthesis Test</button>
            <div id="synthesis-result" class="result"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://zskaxjtyuaqazydouifp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpza2F4anR5dWFxYXp5ZG91aWZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMjk2MzcsImV4cCI6MjA3MDcwNTYzN30.5PhMVptHk3n-1dTSwGF-GvTwrVM0loovkHGUBDtBOe8';

        async function testEnhancement() {
            const resultDiv = document.getElementById('enhancement-result');
            resultDiv.innerHTML = 'Testing enhancement...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/claude-intelligence-synthesizer-v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    },
                    body: JSON.stringify({
                        intelligence_type: 'enhance_organization',
                        organization: {
                            name: 'Toyota',
                            industry: 'automotive',
                            website: 'https://www.toyota.com'
                        },
                        goals: {
                            competitive_positioning: true,
                            media_coverage: true
                        },
                        prompt: 'Enhance Toyota data with automotive industry competitors and insights'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ Enhancement Successful!</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå Enhancement Failed</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
            }
        }

        async function testSynthesis() {
            const resultDiv = document.getElementById('synthesis-result');
            resultDiv.innerHTML = 'Testing synthesis...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/claude-intelligence-synthesizer-v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    },
                    body: JSON.stringify({
                        intelligence_type: 'competitor',
                        mcp_data: {
                            competitive: {
                                'Tesla': { 
                                    news: 'Tesla announces new Model 3 refresh',
                                    sentiment: 'positive'
                                },
                                'Volkswagen': {
                                    news: 'VW invests $5B in EV infrastructure',
                                    sentiment: 'neutral'
                                },
                                'Ford': {
                                    news: 'Ford F-150 Lightning production increases',
                                    sentiment: 'positive'
                                }
                            }
                        },
                        organization: {
                            name: 'Toyota',
                            industry: 'automotive',
                            competitors: ['Tesla', 'Volkswagen', 'Ford'],
                            stakeholders: ['customers', 'investors', 'regulators'],
                            topics: ['electric vehicles', 'hybrid technology', 'sustainability']
                        },
                        goals: {
                            competitive_positioning: true,
                            media_coverage: true
                        },
                        timeframe: '24h'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ Synthesis Successful!</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå Synthesis Failed</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>