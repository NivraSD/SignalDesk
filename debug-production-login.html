<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug Production Login</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #0a0a0a; 
            color: #e5e5e5;
        }
        .error { color: #ef4444; }
        .success { color: #10b981; }
        .info { color: #60a5fa; }
        button { 
            background: #8b5cf6; 
            color: white; 
            border: none; 
            padding: 10px 20px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 6px;
        }
        .result {
            background: #171717;
            border: 1px solid #262626;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Production Login</h1>
    
    <button onclick="checkEnvVars()">1. Check Environment Variables</button>
    <button onclick="testDirectSupabase()">2. Test Direct Supabase Auth</button>
    <button onclick="inspectFrontend()">3. Inspect Frontend Config</button>
    
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            resultsDiv.innerHTML += `<div class="result ${type}">${message}</div>`;
        }
        
        async function checkEnvVars() {
            log('Checking if environment variables are loaded in production...', 'info');
            
            // Open the production site and check console
            const win = window.open('https://signaldesk-frontend.vercel.app', '_blank');
            
            log(`
Open the browser console (F12) and look for:
1. "Supabase configuration missing" warning
2. Check if process.env.REACT_APP_SUPABASE_URL is undefined
3. Look for any API connection errors

If you see "Supabase configuration missing", the env vars aren't loading.
            `, 'info');
        }
        
        async function testDirectSupabase() {
            log('Testing direct Supabase authentication...', 'info');
            
            try {
                const response = await fetch('https://zskaxjtyuaqazydouifp.supabase.co/auth/v1/token?grant_type=password', {
                    method: 'POST',
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpza2F4anR5dWFxYXp5ZG91aWZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMjk2MzcsImV4cCI6MjA3MDcwNTYzN30.5PhMVptHk3n-1dTSwGF-GvTwrVM0loovkHGUBDtBOe8',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@signaldesk.com',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    log('‚úÖ Direct Supabase auth works! User can authenticate.', 'success');
                    log(`Access token: ${data.access_token.substring(0, 50)}...`, 'info');
                } else {
                    log('‚ùå Direct auth failed: ' + JSON.stringify(data), 'error');
                }
            } catch (error) {
                log('‚ùå Network error: ' + error.message, 'error');
            }
        }
        
        async function inspectFrontend() {
            log('Fetching frontend HTML to check build...', 'info');
            
            try {
                const response = await fetch('https://signaldesk-frontend.vercel.app');
                const html = await response.text();
                
                // Check if env vars are in the built code
                const hasSupabaseUrl = html.includes('zskaxjtyuaqazydouifp.supabase.co');
                const hasPlaceholder = html.includes('placeholder.supabase.co');
                
                if (hasSupabaseUrl) {
                    log('‚úÖ Supabase URL is in the production build!', 'success');
                } else if (hasPlaceholder) {
                    log('‚ùå Production is using placeholder values! Env vars not loaded during build.', 'error');
                    log('Solution: Redeploy after ensuring env vars are set in Vercel dashboard', 'info');
                } else {
                    log('‚ö†Ô∏è Cannot determine if Supabase is configured in build', 'info');
                }
                
                // Check for old API references
                const hasOldAPI = html.includes('localhost:3001') || html.includes('railway.app');
                if (hasOldAPI) {
                    log('‚ö†Ô∏è Old API references found in build!', 'error');
                }
            } catch (error) {
                log('Error fetching frontend: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>