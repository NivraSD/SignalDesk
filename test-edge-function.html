<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Edge Function with API Key</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Edge Function Test</h1>
  <div id="status">Testing...</div>
  <div id="result"></div>

  <script>
    const { createClient } = supabase;
    
    // Production credentials
    const supabaseUrl = 'https://zskaxjtyuaqazydouifp.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpza2F4anR5dWFxYXp5ZG91aWZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU3Nzk5MjgsImV4cCI6MjA1MTM1NTkyOH0.MJgH4j8wXJhZgfvMOpViiCyxT-BlLCIIqVMJsE_lXG0';
    
    const client = createClient(supabaseUrl, supabaseAnonKey);
    
    async function testEdgeFunction() {
      const statusEl = document.getElementById('status');
      const resultEl = document.getElementById('result');
      
      try {
        // Test 1: Test health-check function
        statusEl.innerHTML = 'Testing health-check edge function...';
        const { data: healthData, error: healthError } = await client.functions.invoke('health-check');
        
        if (healthError) {
          resultEl.innerHTML += '<p>❌ Health check failed: ' + healthError.message + '</p>';
        } else {
          resultEl.innerHTML += '<p>✅ Health check response:</p>';
          resultEl.innerHTML += '<pre>' + JSON.stringify(healthData, null, 2) + '</pre>';
        }
        
        // Test 2: Test test-api-key function
        statusEl.innerHTML = 'Testing API key edge function...';
        const { data: apiKeyData, error: apiKeyError } = await client.functions.invoke('test-api-key');
        
        if (apiKeyError) {
          resultEl.innerHTML += '<p>❌ API key test failed: ' + apiKeyError.message + '</p>';
        } else {
          resultEl.innerHTML += '<p>✅ API key test response:</p>';
          resultEl.innerHTML += '<pre>' + JSON.stringify(apiKeyData, null, 2) + '</pre>';
        }
        
        // Test 3: Test intelligence-hub-realtime with mock data
        statusEl.innerHTML = 'Testing intelligence-hub-realtime...';
        const { data: intelligenceData, error: intelligenceError } = await client.functions.invoke('intelligence-hub-realtime', {
          body: {
            organizationId: 'test-org',
            industry: 'technology',
            competitors: ['Microsoft', 'Google']
          }
        });
        
        if (intelligenceError) {
          resultEl.innerHTML += '<p>❌ Intelligence hub failed: ' + intelligenceError.message + '</p>';
          resultEl.innerHTML += '<p>Error details: ' + JSON.stringify(intelligenceError) + '</p>';
        } else {
          resultEl.innerHTML += '<p>✅ Intelligence hub response:</p>';
          resultEl.innerHTML += '<pre>' + JSON.stringify(intelligenceData, null, 2) + '</pre>';
        }
        
        statusEl.innerHTML = 'Tests complete';
        
      } catch (error) {
        statusEl.innerHTML = 'Error during testing';
        resultEl.innerHTML += '<p>❌ Unexpected error: ' + error.message + '</p>';
        console.error('Full error:', error);
      }
    }
    
    // Run test
    testEdgeFunction();
  </script>
</body>
</html>