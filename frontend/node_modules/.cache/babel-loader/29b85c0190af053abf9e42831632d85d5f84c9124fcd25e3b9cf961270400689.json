{"ast":null,"code":"// NivStrategicOrchestrator.js - The NEW Niv: Strategic PR Orchestrator\n// Primary interface that controls ALL features through conversation\n// Implements the complete vision from development specification\nimport React,{useState,useEffect,useRef,useCallback}from'react';import{Bot,Send,Sparkles,RefreshCw}from'lucide-react';import supabaseApiService from'../services/supabaseApiService';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const NivStrategicOrchestrator=_ref=>{let{// Feature Control Props\nonFeatureOpen,onContentGenerate,onStrategicPlanGenerate,onWorkCardCreate,// Message State Props\nmessages,setMessages}=_ref;// === CORE STATE ===\nconst[input,setInput]=useState('');const[isProcessing,setIsProcessing]=useState(false);const[clientMode,setClientMode]=useState('NORMAL');// === REAL-TIME FEATURE CONTROL ===\nconst[isGeneratingInFeature,setIsGeneratingInFeature]=useState(false);const[featureGenerationProgress,setFeatureGenerationProgress]=useState('');const messagesEndRef=useRef(null);const inputRef=useRef(null);// === CONSULTATION MODE DETECTION (Enhanced for comprehensive PR strategist) ===\nconst detectConsultationMode=useCallback(message=>{const lowerMessage=message.toLowerCase();const urgencyWords=['urgent','crisis','emergency','breaking','immediate','asap','now'];const analysisWords=['analyze','review','evaluate','assess','thoughts on','opinion','what do you think'];const advisoryWords=['advice','recommend','should i','help me decide','strategy','approach'];const reviewWords=['feedback','review this','look at','check this','improve'];const materialWords=['create','write','draft','generate','make','develop'];// Crisis Response - highest priority\nif(urgencyWords.some(word=>lowerMessage.includes(word))&&(lowerMessage.includes('crisis')||lowerMessage.includes('emergency')||lowerMessage.includes('breaking'))){return'CRISIS_RESPONSE';}// Review Mode - when reviewing existing materials\nif(reviewWords.some(word=>lowerMessage.includes(word))||lowerMessage.includes('attached')||lowerMessage.includes('here is')||lowerMessage.includes('this is')){return'REVIEW_MODE';}// Material Creation - explicit creation requests\nif(materialWords.some(word=>lowerMessage.includes(word))){return'MATERIAL_CREATION';}// Analysis Mode - analytical requests\nif(analysisWords.some(word=>lowerMessage.includes(word))){return'ANALYSIS_MODE';}// Advisory Mode - strategic guidance requests (default)\nreturn'ADVISORY_MODE';},[]);// === IMPROVED FEATURE DETECTION ===\nconst detectFeatureIntent=useCallback(message=>{const lowerMessage=message.toLowerCase();// Only detect features when user uses creation language\nconst hasCreationIntent=['create','write','draft','generate','make','develop'].some(word=>lowerMessage.includes(word));if(!hasCreationIntent){console.log('🚫 No creation intent detected - not triggering features');return null;}// Strategic planning patterns (only with creation intent)\nif(lowerMessage.includes('strategic plan')||lowerMessage.includes('strategy')||lowerMessage.includes('framework')||lowerMessage.includes('roadmap')){return'strategic-planning';}// Content generation patterns (specific content types only)\nif(lowerMessage.includes('press release')||lowerMessage.includes('content')){return'content-generator';}// Media intelligence patterns\nif(lowerMessage.includes('media list')||lowerMessage.includes('media plan')){return'media-intelligence';}console.log('🤔 Creation intent detected but no specific feature match');return null;},[]);// === FEATURE ORCHESTRATION FUNCTIONS ===\nconst initiateContentGeneration=useCallback(async(userMessage,consultationMode)=>{if(!onContentGenerate)return;setIsGeneratingInFeature(true);setFeatureGenerationProgress('Analyzing content requirements...');try{// Call Niv to generate strategic content\nconst response=await supabaseApiService.callNivChat({message:userMessage,context:{consultationMode:consultationMode,detectedFeature:'content-generator',requestType:'content_generation'},mode:'content_orchestration'});setFeatureGenerationProgress('Generating content strategically...');// Trigger content generation in the feature\nonContentGenerate({type:'press-release',// Default type, Niv will guide\ninitialContent:response.response,message:response.response,nivGenerated:true});setFeatureGenerationProgress('Content ready for editing!');}catch(error){console.error('Error in content generation:',error);}finally{setTimeout(()=>{setIsGeneratingInFeature(false);setFeatureGenerationProgress('');},1500);}},[onContentGenerate]);const initiateStrategicPlanning=useCallback(async(userMessage,consultationMode)=>{if(!onStrategicPlanGenerate)return;setIsGeneratingInFeature(true);setFeatureGenerationProgress('Analyzing strategic requirements...');try{var _response$strategicAn;const response=await supabaseApiService.callNivChat({message:userMessage,context:{consultationMode:consultationMode,detectedFeature:'strategic-planning',requestType:'strategic_planning'},mode:'strategic_orchestration'});setFeatureGenerationProgress('Creating strategic framework...');onStrategicPlanGenerate({framework:response.response,nivGenerated:true,strategicInsights:((_response$strategicAn=response.strategicAnalysis)===null||_response$strategicAn===void 0?void 0:_response$strategicAn.strategicInsights)||[]});}catch(error){console.error('Error in strategic planning:',error);}finally{setTimeout(()=>{setIsGeneratingInFeature(false);setFeatureGenerationProgress('');},1500);}},[onStrategicPlanGenerate]);// Helper to format preview content as human-readable text\nconst formatPreviewContent=content=>{if(!content)return'';// If it's a string, return it directly\nif(typeof content==='string'){return content.substring(0,300)+(content.length>300?'...':'');}// If it has a content property (press release), show that\nif(content.content){return content.content.substring(0,300)+(content.content.length>300?'...':'');}// If it has a title and objective (strategy plan), format nicely\nif(content.title&&content.objective){var _content$timeline;let preview=\"\".concat(content.title,\"\\n\\n\\uD83D\\uDCCB Objective: \").concat(content.objective,\"\\n\");// Add timeline milestones if present\nif((_content$timeline=content.timeline)!==null&&_content$timeline!==void 0&&_content$timeline.milestones){preview+='\\n📅 Timeline:\\n';content.timeline.milestones.slice(0,2).forEach(milestone=>{preview+=\"\\u2022 Week \".concat(milestone.week,\": \").concat(milestone.task,\"\\n\");});if(content.timeline.milestones.length>2){preview+=\"...and \".concat(content.timeline.milestones.length-2,\" more milestones\");}}return preview;}// If it's a media list, show journalists\nif(content.journalists){let preview=\"\\uD83D\\uDCF0 Media Targets (\".concat(content.totalContacts||content.journalists.length,\" contacts)\\n\\n\");content.journalists.slice(0,3).forEach(j=>{preview+=\"\\u2022 \".concat(j.name,\" - \").concat(j.outlet,\" (\").concat(j.beat,\")\\n\");});if(content.journalists.length>3){preview+=\"...and \".concat(content.journalists.length-3,\" more journalists\");}return preview;}// Fallback: show key-value pairs nicely\nconst entries=Object.entries(content).slice(0,5);return entries.map(_ref2=>{let[key,value]=_ref2;const formattedKey=key.replace(/([A-Z])/g,' $1').trim();const capitalizedKey=formattedKey.charAt(0).toUpperCase()+formattedKey.slice(1);const formattedValue=typeof value==='object'?'[...]':String(value).substring(0,50);return\"\".concat(capitalizedKey,\": \").concat(formattedValue);}).join('\\n');};// Helper to get details based on work type\nconst getDetailsFromType=type=>{switch(type){case'strategy-plan':return{'Duration':'4 weeks','Status':'Draft','Priority':'High'};case'media-list':return{'Journalists':'5+','Tier 1':'3','Status':'Ready'};case'content-draft':return{'Length':'Full','Status':'Draft','Type':'Press Release'};default:return{};}};// === MESSAGE HANDLING ===\nconst handleSendMessage=useCallback(async()=>{if(!input.trim()||isProcessing)return;const userMessage=input.trim();setInput('');setIsProcessing(true);// Auto-focus input after sending\nsetTimeout(()=>{var _inputRef$current;(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();},100);// Detect consultation mode and feature intent\nconst consultationMode=detectConsultationMode(userMessage);const detectedFeature=detectFeatureIntent(userMessage);setClientMode(consultationMode);// Add user message\nconst userMsg={id:Date.now(),type:'user',content:userMessage,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);try{var _response$response,_response$workItems,_response$workItems2,_response$workItems3,_response$workItems4;console.log('🚀 Sending message to Niv:',userMessage);console.log('📝 Conversation history:',messages);// Get Niv's response with consultation mode and full conversation history\nconst response=await supabaseApiService.callNivChat({message:userMessage,messages:messages,// Pass full conversation history\ncontext:{consultationMode:consultationMode,detectedFeature:detectedFeature,conversationPhase:'understanding'},mode:'strategic_orchestration'});console.log('✅ Niv response received:',response);console.log('🔍 [NivOrchestrator] Response details:',{hasResponse:!!response.response,responseLength:(_response$response=response.response)===null||_response$response===void 0?void 0:_response$response.length,hasWorkItems:!!response.workItems,workItemsCount:((_response$workItems=response.workItems)===null||_response$workItems===void 0?void 0:_response$workItems.length)||0,workItemTypes:((_response$workItems2=response.workItems)===null||_response$workItems2===void 0?void 0:_response$workItems2.map(item=>item.type))||[],workItemTitles:((_response$workItems3=response.workItems)===null||_response$workItems3===void 0?void 0:_response$workItems3.map(item=>item.title))||[],hasGeneratedContent:((_response$workItems4=response.workItems)===null||_response$workItems4===void 0?void 0:_response$workItems4.map(item=>!!item.generatedContent))||[],showWork:response.showWork});// Add Niv's response with consultation mode\nconst assistantMsg={id:Date.now()+1,type:'assistant',content:response.response||'I received your message but had trouble generating a response. Please try again.',timestamp:new Date(),mode:consultationMode,consultationMode:response.consultationMode||consultationMode,strategicAnalysis:response.strategicAnalysis};setMessages(prev=>[...prev,assistantMsg]);// If Niv created work items, send them ONLY to the right panel (NOT in chat)\nif(response.workItems&&response.workItems.length>0){console.log('📦 [NivOrchestrator] Processing work items for RIGHT PANEL ONLY:',response.workItems);// REMOVED: Creating work-card messages in chat\n// Work items should ONLY appear in right panel, not as chat messages\n// Send to right panel artifacts ONLY\nsetTimeout(()=>{// Only notify parent component for right panel artifacts\nif(onWorkCardCreate){console.log('🎯 [NivOrchestrator] Calling onWorkCardCreate for parent component');response.workItems.forEach((item,index)=>{console.log(\"\\uD83C\\uDFAF [NivOrchestrator] Sending work item \".concat(index,\" to parent:\"),{type:item.type,title:item.title,hasGeneratedContent:!!item.generatedContent});// FIXED: Use unified structure - no double nesting\nonWorkCardCreate({type:item.type,title:item.title,description:item.description,generatedContent:item.generatedContent,details:getDetailsFromType(item.type)});});}else{console.log('⚠️ [NivOrchestrator] No onWorkCardCreate callback provided');}},500);}}catch(error){console.error('Error sending message:',error);const errorMsg={id:Date.now()+1,type:'assistant',content:'I apologize - I encountered an issue. Let me help you in a different way. What would you like to work on?',timestamp:new Date()};setMessages(prev=>[...prev,errorMsg]);}finally{setIsProcessing(false);// Re-focus input after processing\nsetTimeout(()=>{var _inputRef$current2;(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.focus();},100);}},[input,isProcessing,detectConsultationMode,detectFeatureIntent,setMessages,messages,onWorkCardCreate]);const handleKeyPress=useCallback(e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage();}},[handleSendMessage]);// Auto-scroll to bottom\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);// Focus input on mount\nuseEffect(()=>{var _inputRef$current3;(_inputRef$current3=inputRef.current)===null||_inputRef$current3===void 0?void 0:_inputRef$current3.focus();},[]);// === COMPONENT RENDER ===\nreturn/*#__PURE__*/_jsxs(\"div\",{style:{height:'calc(100% - 40px)',// Add spacing from bottom\nwidth:'55%',// Reduced from 70% (about 25% reduction)\nmargin:'0 auto',marginBottom:'20px',// Space from bottom\ndisplay:'flex',flexDirection:'column',background:'rgba(0, 0, 0, 0.95)',color:'#e8e8e8',borderRadius:'12px',boxShadow:'0 8px 32px rgba(0, 0, 0, 0.4)',border:'1px solid rgba(59, 130, 246, 0.2)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderBottom:'1px solid rgba(255, 255, 255, 0.1)',background:'rgba(59, 130, 246, 0.1)',display:'flex',alignItems:'center',gap:'0.75rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:'40px',height:'40px',background:'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',borderRadius:'8px',display:'flex',alignItems:'center',justifyContent:'center',position:'relative'},children:[/*#__PURE__*/_jsx(Bot,{size:20,color:\"white\"}),/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'-2px',right:'-2px',width:'12px',height:'12px',background:'#10b981',borderRadius:'50%',border:'2px solid rgba(0, 0, 0, 0.95)'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'600',fontSize:'16px',display:'flex',alignItems:'center',gap:'0.5rem'},children:[\"Niv \\u2022 Senior PR Strategist\",clientMode!=='ADVISORY_MODE'&&/*#__PURE__*/_jsx(\"span\",{style:{padding:'0.25rem 0.5rem',borderRadius:'4px',fontSize:'11px',fontWeight:'500',background:clientMode==='CRISIS_RESPONSE'?'rgba(239, 68, 68, 0.2)':clientMode==='REVIEW_MODE'?'rgba(245, 158, 11, 0.2)':clientMode==='ANALYSIS_MODE'?'rgba(139, 92, 246, 0.2)':clientMode==='MATERIAL_CREATION'?'rgba(16, 185, 129, 0.2)':'rgba(59, 130, 246, 0.2)',color:clientMode==='CRISIS_RESPONSE'?'#ef4444':clientMode==='REVIEW_MODE'?'#f59e0b':clientMode==='ANALYSIS_MODE'?'#8b5cf6':clientMode==='MATERIAL_CREATION'?'#10b981':'#3b82f6'},children:clientMode==='CRISIS_RESPONSE'?'🚨 Crisis Response':clientMode==='REVIEW_MODE'?'📋 Review Mode':clientMode==='ANALYSIS_MODE'?'📊 Analysis Mode':clientMode==='MATERIAL_CREATION'?'✨ Creating Materials':'🎯 Strategic Advisory'})]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#9ca3af',display:'flex',alignItems:'center',gap:'0.25rem'},children:[/*#__PURE__*/_jsx(Sparkles,{size:12}),\"Comprehensive PR strategist \\u2022 Advisory \\u2022 Analysis \\u2022 Crisis \\u2022 Review \\u2022 Creation\"]})]})]}),(isProcessing||isGeneratingInFeature)&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',background:'linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%)',borderBottom:'1px solid rgba(59, 130, 246, 0.2)',display:'flex',alignItems:'center',gap:'0.75rem',position:'relative',overflow:'hidden'},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:0,left:0,height:'2px',width:'100%',background:'linear-gradient(90deg, transparent, #3b82f6, transparent)',animation:'shimmer 2s infinite'}}),/*#__PURE__*/_jsx(\"div\",{style:{animation:'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(Sparkles,{size:16,color:\"#3b82f6\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'500',color:'#3b82f6'},children:isGeneratingInFeature?'Niv is working in the feature...':'Niv is thinking...'}),featureGenerationProgress&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#60a5fa'},children:featureGenerationProgress})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto',padding:'1rem',display:'flex',flexDirection:'column',gap:'1rem'},children:[messages.map(message=>message.type==='work-card'?/*#__PURE__*/// Inline Work Card\n_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%)',border:'1px solid rgba(99, 102, 241, 0.3)',borderRadius:'12px',padding:'16px',marginLeft:'60px',marginRight:'20%',animation:'slideIn 0.5s ease-out'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'12px',marginBottom:'12px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'36px',height:'36px',background:'linear-gradient(135deg, #6366f1, #8b5cf6)',borderRadius:'8px',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(Sparkles,{size:18,color:\"white\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',fontWeight:'600',color:'#fff'},children:message.workCard.data.title}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#8b5cf6'},children:\"Created by Niv \\u2022 Click to open in workspace\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'13px',color:'#e0e0e0',lineHeight:'1.5',marginBottom:'12px'},children:message.workCard.data.description}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'12px',background:'rgba(139, 92, 246, 0.1)',border:'1px solid rgba(139, 92, 246, 0.3)',borderRadius:'8px',fontSize:'12px',color:'#a78bfa',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(Sparkles,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2705 Generated and ready to edit in workspace \\u2192 Check right panel\"})]})]},message.id):/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:message.type==='user'?'flex-end':'flex-start'},children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'80%',padding:'0.75rem 1rem',borderRadius:'12px',background:message.type==='user'?'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)':'rgba(255, 255, 255, 0.08)',color:message.type==='user'?'white':'#e8e8e8'},children:[message.type==='assistant'&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',marginBottom:'0.5rem',fontSize:'12px',color:'#9ca3af'},children:[/*#__PURE__*/_jsx(Bot,{size:14}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'500'},children:\"Niv\"}),message.mode&&/*#__PURE__*/_jsx(\"span\",{style:{padding:'0.125rem 0.375rem',background:'rgba(59, 130, 246, 0.2)',color:'#60a5fa',borderRadius:'4px',fontSize:'10px'},children:message.mode})]}),/*#__PURE__*/_jsx(\"div\",{style:{whiteSpace:'pre-wrap',lineHeight:'1.5'},children:message.content}),message.timestamp&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',opacity:0.7,marginTop:'0.5rem'},children:new Date(message.timestamp).toLocaleTimeString()})]})},message.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderTop:'1px solid rgba(255, 255, 255, 0.1)',background:'rgba(0, 0, 0, 0.5)',display:'flex',gap:'0.75rem'},children:[/*#__PURE__*/_jsx(\"textarea\",{ref:inputRef,value:input,onChange:e=>setInput(e.target.value),onKeyPress:handleKeyPress,placeholder:\"Ask Niv for strategic advice, crisis response, material review, analysis, or content creation...\",style:{flex:1,padding:'0.75rem 1rem',background:'rgba(255, 255, 255, 0.05)',border:'1px solid rgba(255, 255, 255, 0.1)',borderRadius:'8px',color:'#e8e8e8',fontSize:'14px',outline:'none',resize:'vertical',minHeight:'50px',maxHeight:'150px',fontFamily:'inherit',lineHeight:'1.5'},disabled:isProcessing,onFocus:e=>e.target.style.borderColor='rgba(59, 130, 246, 0.5)',onBlur:e=>e.target.style.borderColor='rgba(255, 255, 255, 0.1)'}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,disabled:!input.trim()||isProcessing,style:{padding:'0.75rem 1.25rem',borderRadius:'8px',border:'none',background:!input.trim()||isProcessing?'rgba(255, 255, 255, 0.1)':'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',color:!input.trim()||isProcessing?'#6b7280':'white',cursor:!input.trim()||isProcessing?'not-allowed':'pointer',display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'14px',fontWeight:'500',transition:'all 0.2s',position:'relative'},children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(RefreshCw,{size:16,style:{animation:'spin 1s linear infinite',opacity:0.7}}),/*#__PURE__*/_jsx(\"span\",{style:{opacity:0.8},children:\"Thinking...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Send,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"Send\"})]})})]}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes spin {\\n          from { transform: rotate(0deg); }\\n          to { transform: rotate(360deg); }\\n        }\\n        @keyframes shimmer {\\n          0% { transform: translateX(-100%); }\\n          100% { transform: translateX(100%); }\\n        }\\n        @keyframes pulse {\\n          0%, 100% { opacity: 1; }\\n          50% { opacity: 0.5; }\\n        }\\n        @keyframes slideIn {\\n          from { \\n            opacity: 0;\\n            transform: translateY(10px);\\n          }\\n          to {\\n            opacity: 1;\\n            transform: translateY(0);\\n          }\\n        }\\n      \"})]});};export default NivStrategicOrchestrator;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}