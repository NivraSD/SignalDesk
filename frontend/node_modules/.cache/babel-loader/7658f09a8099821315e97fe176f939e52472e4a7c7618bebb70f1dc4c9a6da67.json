{"ast":null,"code":"import _objectSpread from\"/Users/jonathanliebowitz/Desktop/SignalDesk/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// RailwayDraggable.js - Railway-style with draggable and resizable components\nimport React,{useState,useEffect,useRef,useCallback}from'react';import{useParams,useNavigate}from'react-router-dom';import{useProject}from'../contexts/ProjectContext';import{useAuth}from'../contexts/AuthContext';import ContentGeneratorModule from'./ContentGeneratorModule';import StrategicPlanningOptimized from'./StrategicPlanningOptimized';import OpportunityEngine from'./OpportunityEngine';import NivStrategicOrchestrator from'./NivStrategicOrchestrator';import supabaseApiService from'../services/supabaseApiService';import{Bot,Brain,FileText,Users,TrendingUp,AlertTriangle,BarChart3,Archive,Send,ChevronLeft,ChevronRight,X,Sparkles,MessageSquare,Shield,Target,Menu,GripVertical,Maximize2,Minimize2,Move,GitBranch,Activity,Database,Circle,Square,ArrowLeft,Clock,Zap,Globe,Settings,User,Plus,ChevronDown,LogOut,Folder,StickyNote,RefreshCw}from'lucide-react';import'./RailwayDraggable.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const RailwayDraggable=()=>{var _positions$aiAssista,_positions$aiAssista2,_sizes$aiAssistant,_sizes$aiAssistant2,_positions$activityL,_positions$activityL2,_sizes$activityList,_sizes$activityList2,_positions$featureVi,_positions$featureVi2,_sizes$featureView,_sizes$featureView2,_positions$notepad,_positions$notepad2,_sizes$notepad,_sizes$notepad2;const{projectId}=useParams();const navigate=useNavigate();const{activeProject,projects,fetchProjects,selectProject}=useProject();const{user,logout}=useAuth();const messagesEndRef=useRef(null);const inputRef=useRef(null);// View state - either showing activity list or expanded feature\nconst[currentView,setCurrentView]=useState('activity');// 'activity' or 'feature'\nconst[selectedFeature,setSelectedFeature]=useState(null);const[isTransitioning,setIsTransitioning]=useState(false);// AI Assistant state - PRESERVING ALL FUNCTIONALITY\nconst[message,setMessage]=useState('');const[messages,setMessages]=useState([]);const[loading,setLoading]=useState(false);const[isEditingMode,setIsEditingMode]=useState(false);const[aiPanelOpen,setAiPanelOpen]=useState(true);// Content Generator state - PRESERVING ALL FUNCTIONALITY\nconst[generatedContent,setGeneratedContent]=useState('');const[currentContentType,setCurrentContentType]=useState(null);const[selectedContentTypeId,setSelectedContentTypeId]=useState(null);const[selectedContentTypeName,setSelectedContentTypeName]=useState(null);// NEW: Niv real-time integration state\nconst[nivGeneratedData,setNivGeneratedData]=useState(null);const[isNivGenerating,setIsNivGenerating]=useState(false);// Strategic Planning state\nconst[strategicPlanData,setStrategicPlanData]=useState(null);// Drag and resize state\nconst[draggedElement,setDraggedElement]=useState(null);const[resizingElement,setResizingElement]=useState(null);const[positions,setPositions]=useState({});const[sizes,setSizes]=useState({});const[dragOffset,setDragOffset]=useState({x:0,y:0});// Profile dropdown state\nconst[showProfileMenu,setShowProfileMenu]=useState(false);const[showProjectMenu,setShowProjectMenu]=useState(false);const[showNewProjectModal,setShowNewProjectModal]=useState(false);const[newProjectName,setNewProjectName]=useState('');const[showNotepad,setShowNotepad]=useState(false);const[notes,setNotes]=useState([]);const[newNote,setNewNote]=useState('');const[notepadMinimized,setNotepadMinimized]=useState(false);// Session ID for conversation continuity - v3 force update\nconst[sessionId]=useState(()=>\"session-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9)));// Feature/Activity definitions\nconst activities=[{id:'content-generator',name:'Content Generator',icon:FileText,color:'#8b5cf6',description:'AI-powered content creation',status:'ready',stats:'12 pieces created today',component:ContentGeneratorModule,lastUsed:'2 minutes ago'},{id:'media-intelligence',name:'Media Intelligence',icon:Users,color:'#10b981',description:'Journalist discovery & outreach',status:'ready',stats:'234 journalists tracked',path:\"/projects/\".concat(projectId,\"/media-list\"),lastUsed:'1 hour ago'},{id:'strategic-planning',name:'Strategic Planning',icon:Brain,color:'#f59e0b',description:'Evidence-based strategic plans',status:'ready',stats:'AI-powered planning',component:StrategicPlanningOptimized,lastUsed:'3 hours ago'},{id:'opportunity-engine',name:'Opportunity Engine',icon:Zap,color:'#f59e0b',description:'AI-powered PR opportunity discovery',status:'ready',stats:'5 active opportunities',component:'OpportunityEngine',lastUsed:'Just now'},{id:'memory-vault',name:'Memory Vault',icon:Database,color:'#6366f1',description:'Project knowledge base',status:'ready',stats:'1,234 items stored',path:\"/projects/\".concat(projectId),lastUsed:'5 minutes ago'},{id:'stakeholder-monitoring',name:'Stakeholder Intelligence',icon:Activity,color:'#00bcd4',description:'Monitor stakeholders & gather intelligence',status:'active',stats:'Live monitoring active',path:\"/projects/\".concat(projectId,\"/stakeholder-intelligence\"),lastUsed:'Active now'},{id:'crisis-command',name:'Crisis Command',icon:AlertTriangle,color:'#ef4444',description:'Crisis management center',status:'ready',stats:'No active crises',path:\"/projects/\".concat(projectId,\"/crisis-command\"),lastUsed:'2 days ago'},{id:'reports',name:'Reports & Analytics',icon:BarChart3,color:'#14b8a6',description:'Performance metrics & insights',status:'ready',stats:'5 reports generated',path:\"/projects/\".concat(projectId,\"/reports\"),lastUsed:'6 hours ago'}];// Initialize positions and sizes\nuseEffect(()=>{// Load saved positions and sizes or use defaults\nconst savedPositions=localStorage.getItem('railwayDragPositions');const savedSizes=localStorage.getItem('railwayDragSizes');setPositions(savedPositions?JSON.parse(savedPositions):{'ai-assistant':{x:20,y:80},'activity-list':{x:420,y:80},'feature-view':{x:420,y:80},'notepad':{x:940,y:80}});setSizes(savedSizes?JSON.parse(savedSizes):{'ai-assistant':{width:400,height:400},'activity-list':{width:500,height:400},'feature-view':{width:800,height:600},'notepad':{width:350,height:400}});// Load projects\nfetchProjects();},[]);// Initialize AI Assistant\nuseEffect(()=>{setMessages([{id:Date.now(),type:'assistant',content:\"Welcome to SignalDesk! I'm your AI assistant. I can help you create content, find journalists, plan campaigns, and more. Just tell me what you need - for example, 'I need to write a press release' or 'Find tech journalists'. You can also click any feature from the list to get started.\",timestamp:new Date()}]);},[]);// Save positions and sizes\nconst saveLayout=useCallback(()=>{localStorage.setItem('railwayDragPositions',JSON.stringify(positions));localStorage.setItem('railwayDragSizes',JSON.stringify(sizes));},[positions,sizes]);// Handle drag start\nconst handleDragStart=(e,elementId)=>{e.preventDefault();setDraggedElement(elementId);const rect=e.currentTarget.parentElement.getBoundingClientRect();setDragOffset({x:e.clientX-rect.left,y:e.clientY-rect.top});};// Handle drag move\nconst handleDragMove=useCallback(e=>{if(!draggedElement)return;const newPosition={x:Math.max(0,e.clientX-dragOffset.x),y:Math.max(60,e.clientY-dragOffset.y)// Keep below header\n};setPositions(prev=>_objectSpread(_objectSpread({},prev),{},{[draggedElement]:newPosition}));},[draggedElement,dragOffset]);// Handle drag end\nconst handleDragEnd=useCallback(()=>{if(draggedElement){saveLayout();}setDraggedElement(null);},[draggedElement,saveLayout]);// Handle resize start\nconst handleResizeStart=(e,elementId)=>{e.preventDefault();e.stopPropagation();setResizingElement(elementId);};// Handle resize move\nconst handleResizeMove=useCallback(e=>{if(!resizingElement)return;const element=document.getElementById(resizingElement);if(!element)return;const rect=element.getBoundingClientRect();const newSize={width:Math.max(300,e.clientX-rect.left),height:Math.max(300,e.clientY-rect.top)};setSizes(prev=>_objectSpread(_objectSpread({},prev),{},{[resizingElement]:newSize}));},[resizingElement]);// Handle resize end\nconst handleResizeEnd=useCallback(()=>{if(resizingElement){saveLayout();}setResizingElement(null);},[resizingElement,saveLayout]);// Mouse event handlers\nuseEffect(()=>{if(draggedElement){window.addEventListener('mousemove',handleDragMove);window.addEventListener('mouseup',handleDragEnd);return()=>{window.removeEventListener('mousemove',handleDragMove);window.removeEventListener('mouseup',handleDragEnd);};}},[draggedElement,handleDragMove,handleDragEnd]);useEffect(()=>{if(resizingElement){window.addEventListener('mousemove',handleResizeMove);window.addEventListener('mouseup',handleResizeEnd);return()=>{window.removeEventListener('mousemove',handleResizeMove);window.removeEventListener('mouseup',handleResizeEnd);};}},[resizingElement,handleResizeMove,handleResizeEnd]);// Handle activity/feature selection\nconst handleActivityClick=activity=>{if(activity.path&&!activity.component){// External route - navigate away\nnavigate(activity.path);return;}// Expand the feature in place\nsetIsTransitioning(true);setTimeout(()=>{setSelectedFeature(activity);setCurrentView('feature');setIsTransitioning(false);// AI context handled by backend now\n// adaptiveAI.setActiveFeature(activity.id);\n},300);};// Handle back to activity list\nconst handleBackToActivities=()=>{setIsTransitioning(true);setTimeout(()=>{setCurrentView('activity');setSelectedFeature(null);setIsEditingMode(false);setGeneratedContent('');setIsTransitioning(false);// AI reset handled by backend now\n// adaptiveAI.reset();\n},300);};// Handle project creation\nconst handleCreateProject=async()=>{if(!newProjectName.trim())return;try{const newProject=await supabaseApiService.createProject({name:newProjectName,user_id:user===null||user===void 0?void 0:user.id});if(newProject){await fetchProjects();selectProject(newProject);navigate(\"/projects/\".concat(newProject.id));setShowNewProjectModal(false);setNewProjectName('');}}catch(error){console.error('Failed to create project:',error);}};// Handle project switch\nconst handleSwitchProject=project=>{selectProject(project);navigate(\"/projects/\".concat(project.id));setShowProjectMenu(false);};// Notes functionality\nuseEffect(()=>{// Load notes from localStorage\nconst savedNotes=localStorage.getItem(\"notes-\".concat(projectId));if(savedNotes){setNotes(JSON.parse(savedNotes));}},[projectId]);const addNote=()=>{if(!newNote.trim())return;const note={id:Date.now(),text:newNote.trim(),timestamp:new Date().toISOString()};const updatedNotes=[...notes,note];setNotes(updatedNotes);localStorage.setItem(\"notes-\".concat(projectId),JSON.stringify(updatedNotes));setNewNote('');};const deleteNote=noteId=>{const updatedNotes=notes.filter(note=>note.id!==noteId);setNotes(updatedNotes);localStorage.setItem(\"notes-\".concat(projectId),JSON.stringify(updatedNotes));};// CRITICAL: Handle messages from Content Generator - EXACT RESTORATION\nconst handleContentGeneratorMessage=msg=>{console.log('RailwayDraggable: Received message from ContentGenerator:',msg);if(msg.type==='edit_request'){setIsEditingMode(true);handleEditRequest(msg);}else if(msg.type==='content_saved'){// Content was saved - reset handled by backend\n// adaptiveAI.reset();\nconst successMsg={id:\"save-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9)),type:'system',content:msg.content,timestamp:new Date()};setMessages(prev=>[...prev,successMsg]);}else if(msg.type==='user'&&msg.content){// When user selects a content type in Content Generator, trigger Niv\nconst userMsg={id:\"content-user-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9)),type:'user',content:msg.content,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);// Store the content type for future use\nif(msg.contentTypeId){setSelectedContentTypeId(msg.contentTypeId);setSelectedContentTypeName(msg.contentTypeName);}// Open AI Assistant panel to show Niv is working on it\nsetAiPanelOpen(true);// Trigger Niv's content generation flow\n// This will be handled by AdaptiveNivAssistantEnhanced which is watching messages\n// Pass content type info if available from Content Generator\nsendMessage(msg.content,msg.contentTypeId,msg.contentTypeName);}};// CRITICAL: Handle edit requests - EXACT RESTORATION\nconst handleEditRequest=async request=>{const{content:editPrompt,currentContent,metadata}=request;const userMsg={id:Date.now(),type:'user',content:\"Please edit this content: \\\"\".concat(editPrompt,\"\\\"\"),timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);setLoading(true);try{const data=await supabaseApiService.sendClaudeMessage(\"Edit the following content based on this request: \\\"\".concat(editPrompt,\"\\\"\\n\\nCurrent content:\\n\").concat(currentContent),{mode:'content',sessionId:sessionId,folder:'content-generator',editing:true,contentType:metadata===null||metadata===void 0?void 0:metadata.contentType,tone:metadata===null||metadata===void 0?void 0:metadata.tone});if(data.success&&data.response){// Update content directly in the Content Generator feature (not in chat)\nsetGeneratedContent(data.response);// Show confirmation message in chat instead of the edited content\nconst confirmMsg={id:Date.now(),type:'system',content:'âœ… Content updated successfully! You can see the changes in the Content Generator.',timestamp:new Date()};setMessages(prev=>[...prev,confirmMsg]);}}catch(error){console.error('Error processing edit:',error);const errorMsg={id:Date.now(),type:'error',content:'Failed to process edit request. Please try again.',timestamp:new Date()};setMessages(prev=>[...prev,errorMsg]);}finally{setLoading(false);}};// RESTART FUNCTIONALITY - Reset all states and return to activity view\nconst restartProject=()=>{console.log('ðŸ”„ Restarting project page...');// Reset view states\nsetCurrentView('activity');setSelectedFeature(null);setIsTransitioning(false);// Reset AI Assistant states\nsetMessages([]);setMessage('');setLoading(false);setIsEditingMode(false);// Reset Content Generator states\nsetGeneratedContent('');setCurrentContentType(null);setSelectedContentTypeId(null);setSelectedContentTypeName(null);// Reset drag/resize states\nsetDraggedElement(null);setResizingElement(null);setPositions({});setSizes({});// Reset modals and dropdowns\nsetShowProfileMenu(false);setShowProjectMenu(false);setShowNewProjectModal(false);setShowNotepad(false);// Add restart confirmation message\nconst restartMsg={id:\"restart-\".concat(Date.now()),type:'system',content:'ðŸ”„ Project page has been restarted. All states have been reset.',timestamp:new Date()};setTimeout(()=>{setMessages([restartMsg]);},100);console.log('âœ… Project restart complete');};// FIXED AI message handling - direct backend call, no local processing\nconst sendMessage=async function(text){let contentTypeId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let contentTypeName=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!(text!==null&&text!==void 0&&text.trim()))return;console.log('[FIXED] Sending message:',text);// Use stored content type if not provided\nconst typeId=contentTypeId||selectedContentTypeId;const typeName=contentTypeName||selectedContentTypeName;// Check if this is a content-related message\nconst isContentMessage=text.toLowerCase().includes('thought leadership')||text.toLowerCase().includes('press release')||text.toLowerCase().includes('social media')||text.toLowerCase().includes('blog')||text.toLowerCase().includes('email')||(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='content-generator';// If it's a content message, ensure Content Generator is open\nif(isContentMessage&&(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)!=='content-generator'){const contentGen=activities.find(a=>a.id==='content-generator');handleActivityClick(contentGen);}setLoading(true);try{const hasContent=!!(generatedContent&&generatedContent.trim());const data=await supabaseApiService.sendClaudeMessage(text,{mode:isContentMessage?'content':'general',sessionId:sessionId,folder:isContentMessage?'content-generator':'general',contentTypeId:typeId,contentTypeName:typeName||text,// Use message as content type if not specified\nhasGeneratedContent:hasContent,currentContent:generatedContent});if(data.success&&data.response){if(data.isGeneratedContent){// Auto-open Content Generator if not already open\nif((selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)!=='content-generator'){const contentGen=activities.find(a=>a.id==='content-generator');handleActivityClick(contentGen);}setGeneratedContent(data.response);detectContentType(data.response);const successMsg={id:Date.now(),type:'system',content:'âœ¨ Content generated successfully! You can see it in the Content Generator panel.',timestamp:new Date()};setMessages(prev=>[...prev,successMsg]);}else{const aiMsg={id:Date.now(),type:'assistant',content:data.response,timestamp:new Date()};setMessages(prev=>[...prev,aiMsg]);}}}catch(error){console.error('Error sending message:',error);const errorMsg={id:Date.now(),type:'error',content:'Failed to send message. Please check your connection.',timestamp:new Date()};setMessages(prev=>[...prev,errorMsg]);}finally{setLoading(false);}};// Generate content directly in the Content Generator feature\nconst generateContentInFeature=async params=>{// First, ensure Content Generator is open\nif((selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)!=='content-generator'){const contentGen=activities.find(a=>a.id==='content-generator');handleActivityClick(contentGen);// Wait for transition\nawait new Promise(resolve=>setTimeout(resolve,500));}setLoading(true);try{// Build prompt from guided flow context\nconst prompt=\"Create a \".concat(params.type,\" about \").concat(params.topic,\" for \").concat(params.audience,\" audience with a \").concat(params.tone,\" tone. \").concat(params.keyPoints||'');const data=await supabaseApiService.sendClaudeMessage(prompt,{mode:'content',sessionId:sessionId,folder:'content-generator',contentType:params.type,contentTypeId:params.type,// CRITICAL: Backend expects contentTypeId\ncontentTypeName:params.type,generateDirectly:true,userRequestedGeneration:true});if(data.success&&data.response){// Set the generated content directly\nsetGeneratedContent(data.response);setCurrentContentType(params.type);// Notify user in chat\nconst successMsg={id:Date.now(),type:'system',content:'âœ¨ Content generated successfully! You can see it in the Content Generator. Feel free to ask me to make any edits.',timestamp:new Date()};setMessages(prev=>[...prev,successMsg]);}}catch(error){console.error('Error generating content:',error);}finally{setLoading(false);}};// Handle form submission\nconst handleSubmit=e=>{e.preventDefault();if(!message.trim()||loading)return;const userMsg={id:\"user-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9)),type:'user',content:message,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);sendMessage(message);setMessage('');// Keep focus on input\nsetTimeout(()=>{var _inputRef$current;(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();},50);};// Check if response is actual generated content\nconst isActualGeneratedContent=text=>{if(!text||text.length<100)return false;const indicators=['FOR IMMEDIATE RELEASE','Dear ','Subject:','Q:','Question:','#','We are pleased'];return indicators.some(indicator=>text.includes(indicator));};// Detect content type\nconst detectContentType=text=>{if(text.includes('FOR IMMEDIATE RELEASE')){setCurrentContentType('press-release');}else if(text.includes('Q:')||text.includes('Question:')){setCurrentContentType('qa-doc');}else if(text.includes('#')){setCurrentContentType('social-post');}};// Update content from Content Generator\nconst handleContentUpdate=newContent=>{setGeneratedContent(newContent);if(newContent&&!isEditingMode){setIsEditingMode(false);}};// Auto-scroll messages\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);// Auto-resize textarea and maintain focus\nuseEffect(()=>{if(inputRef.current){inputRef.current.style.height='auto';inputRef.current.style.height=Math.min(inputRef.current.scrollHeight,120)+'px';}},[message]);// Maintain focus on input after messages\nuseEffect(()=>{if(inputRef.current&&!loading){// Small delay to ensure DOM is updated\nsetTimeout(()=>{var _inputRef$current2;(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.focus();},100);}},[messages,loading]);return/*#__PURE__*/_jsxs(\"div\",{className:\"railway-draggable-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"railway-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"signaldesk-brand\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"brand-text\",children:\"SignalDesk\"}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#8b5cf6',fontWeight:'bold',marginLeft:'8px'},children:\"v3.2-FIXED\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"project-selector\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"project-dropdown-button\",onClick:()=>setShowProjectMenu(!showProjectMenu),children:[/*#__PURE__*/_jsx(Folder,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:(activeProject===null||activeProject===void 0?void 0:activeProject.name)||'Select Project'}),/*#__PURE__*/_jsx(ChevronDown,{size:16})]}),showProjectMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-menu project-menu\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-header\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Projects\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'4px'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"new-project-button\",onClick:e=>{e.stopPropagation();fetchProjects();},title:\"Refresh projects\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"14\",height:\"14\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"new-project-button\",onClick:()=>{setShowProjectMenu(false);setShowNewProjectModal(true);},title:\"New project\",children:/*#__PURE__*/_jsx(Plus,{size:14})})]})]}),projects===null||projects===void 0?void 0:projects.map(project=>/*#__PURE__*/_jsxs(\"button\",{className:\"dropdown-item \".concat(project.id===(activeProject===null||activeProject===void 0?void 0:activeProject.id)?'active':''),onClick:()=>handleSwitchProject(project),children:[/*#__PURE__*/_jsx(Folder,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:project.name}),project.id===(activeProject===null||activeProject===void 0?void 0:activeProject.id)&&/*#__PURE__*/_jsx(Circle,{size:8,fill:\"currentColor\"})]},project.id))]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"environment-badge\",children:\"Production\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-right\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"header-button restart-button\",onClick:restartProject,title:\"Restart project page and reset all states\",children:[/*#__PURE__*/_jsx(RefreshCw,{size:16}),\"Restart\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"header-button \".concat(showNotepad?'active':''),onClick:()=>setShowNotepad(!showNotepad),children:[/*#__PURE__*/_jsx(StickyNote,{size:16}),\"Notes\",notes.length>0&&/*#__PURE__*/_jsx(\"span\",{className:\"notes-badge\",children:notes.length})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"header-button\",children:[/*#__PURE__*/_jsx(Settings,{size:16}),\"Settings\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-profile\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"profile-button\",onClick:()=>setShowProfileMenu(!showProfileMenu),children:[/*#__PURE__*/_jsx(User,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:(user===null||user===void 0?void 0:user.email)||'User'}),/*#__PURE__*/_jsx(ChevronDown,{size:14})]}),showProfileMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-menu profile-menu\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/_jsx(User,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-name\",children:(user===null||user===void 0?void 0:user.name)||(user===null||user===void 0?void 0:user.email)}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-email\",children:user===null||user===void 0?void 0:user.email})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"dropdown-divider\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"dropdown-item\",children:[/*#__PURE__*/_jsx(Settings,{size:14}),\"Account Settings\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"dropdown-item\",onClick:()=>{logout();navigate('/login');},children:[/*#__PURE__*/_jsx(LogOut,{size:14}),\"Sign Out\"]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{id:\"ai-assistant\",className:\"draggable-panel ai-assistant-square\",style:{left:\"\".concat(((_positions$aiAssista=positions['ai-assistant'])===null||_positions$aiAssista===void 0?void 0:_positions$aiAssista.x)||20,\"px\"),top:\"\".concat(((_positions$aiAssista2=positions['ai-assistant'])===null||_positions$aiAssista2===void 0?void 0:_positions$aiAssista2.y)||80,\"px\"),width:\"\".concat(((_sizes$aiAssistant=sizes['ai-assistant'])===null||_sizes$aiAssistant===void 0?void 0:_sizes$aiAssistant.width)||400,\"px\"),height:\"\".concat(((_sizes$aiAssistant2=sizes['ai-assistant'])===null||_sizes$aiAssistant2===void 0?void 0:_sizes$aiAssistant2.height)||400,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-header\",onMouseDown:e=>handleDragStart(e,'ai-assistant'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-title\",children:[/*#__PURE__*/_jsx(Brain,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:\"Niv \\u2022 Senior PR Strategist\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"panel-controls\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAiPanelOpen(!aiPanelOpen),children:aiPanelOpen?/*#__PURE__*/_jsx(Minimize2,{size:14}):/*#__PURE__*/_jsx(Maximize2,{size:14})})})]}),aiPanelOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"panel-content\",style:{padding:0,height:'calc(100% - 40px)'},children:/*#__PURE__*/_jsx(NivStrategicOrchestrator,{messages:messages,setMessages:setMessages,currentFeature:selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id,onFeatureOpen:featureId=>{// Find and open the requested feature\nconst feature=activities.find(a=>a.id===featureId);if(feature){handleActivityClick(feature);}},onContentGenerate:contentData=>{// Handle content generation from Niv - Enhanced for real-time editing\nsetIsNivGenerating(true);if(contentData.initialContent){setGeneratedContent(contentData.initialContent);setNivGeneratedData(contentData);}else{setGeneratedContent(contentData.message||contentData.content||'');}setCurrentContentType(contentData.type||'press-release');// Open Content Generator if not already open\nif((selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)!=='content-generator'){const contentGen=activities.find(a=>a.id==='content-generator');if(contentGen){handleActivityClick(contentGen);}}// Stop generating indicator after content is set\nsetTimeout(()=>setIsNivGenerating(false),1000);},onNivEdit:async editData=>{// Handle Niv's real-time editing\nsetIsNivGenerating(true);try{const response=await supabaseApiService.callNivChat({message:\"Edit this content: \\\"\".concat(editData.editRequest,\"\\\"\\n\\nCurrent content:\\n\").concat(editData.currentContent),context:{clientMode:'URGENT_FIRE',detectedFeature:'content-generator',editMode:true,contentType:editData.contentType},mode:'content_editing'});if(response.response){setGeneratedContent(response.response);// Add Niv's edit explanation to messages\nsetMessages(prev=>[...prev,{id:Date.now(),type:'assistant',content:\"I've updated the content based on your request: \\\"\".concat(editData.editRequest,\"\\\"\"),timestamp:new Date()}]);}}catch(error){console.error('Error in Niv editing:',error);setMessages(prev=>[...prev,{id:Date.now(),type:'assistant',content:'I apologize - there was an issue editing the content. Let me try a different approach.',timestamp:new Date()}]);}finally{setIsNivGenerating(false);}},onStrategicPlanGenerate:planData=>{// Handle strategic plan generation from Niv\nconsole.log('Generating strategic plan:',planData);// Set the plan data for Strategic Planning component\nsetStrategicPlanData(planData);// Open Strategic Planning if not already open\nif((selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)!=='strategic-planning'){const strategicPlanning=activities.find(a=>a.id==='strategic-planning');if(strategicPlanning){handleActivityClick(strategicPlanning);}}}})}),/*#__PURE__*/_jsx(\"div\",{className:\"resize-handle\",onMouseDown:e=>handleResizeStart(e,'ai-assistant')})]}),currentView==='activity'?/*#__PURE__*/_jsxs(\"div\",{id:\"activity-list\",className:\"draggable-panel activity-list-panel\",style:{left:\"\".concat(((_positions$activityL=positions['activity-list'])===null||_positions$activityL===void 0?void 0:_positions$activityL.x)||420,\"px\"),top:\"\".concat(((_positions$activityL2=positions['activity-list'])===null||_positions$activityL2===void 0?void 0:_positions$activityL2.y)||80,\"px\"),width:\"\".concat(((_sizes$activityList=sizes['activity-list'])===null||_sizes$activityList===void 0?void 0:_sizes$activityList.width)||500,\"px\"),height:\"\".concat(((_sizes$activityList2=sizes['activity-list'])===null||_sizes$activityList2===void 0?void 0:_sizes$activityList2.height)||400,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-header\",onMouseDown:e=>handleDragStart(e,'activity-list'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-title\",children:[/*#__PURE__*/_jsx(Activity,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:\"Activities\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"panel-controls\",children:/*#__PURE__*/_jsx(Move,{size:14})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"panel-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"activity-list\",children:activities.map(activity=>{const Icon=activity.icon;return/*#__PURE__*/_jsxs(\"div\",{className:\"activity-item \".concat(activity.status),onClick:()=>handleActivityClick(activity),children:[/*#__PURE__*/_jsx(\"div\",{className:\"activity-icon\",style:{backgroundColor:\"\".concat(activity.color,\"15\")},children:/*#__PURE__*/_jsx(Icon,{size:20,style:{color:activity.color}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"activity-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[activity.name,activity.isNew&&/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:'8px',padding:'2px 6px',background:'linear-gradient(135deg, #f59e0b 0%, #dc2626 100%)',borderRadius:'4px',fontSize:'10px',fontWeight:'bold',color:'white'},children:\"NEW\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"activity-status \".concat(activity.status),children:activity.status==='ready'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Circle,{size:6,fill:\"currentColor\"}),\" Ready\"]}):activity.status==='building'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Zap,{size:10}),\" Building\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Clock,{size:10}),\" Pending\"]})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"activity-description\",children:activity.description})]}),/*#__PURE__*/_jsx(ChevronRight,{size:18,className:\"activity-arrow\"})]},activity.id);})})}),/*#__PURE__*/_jsx(\"div\",{className:\"resize-handle\",onMouseDown:e=>handleResizeStart(e,'activity-list')})]}):/*#__PURE__*/_jsxs(\"div\",{id:\"feature-view\",className:\"draggable-panel feature-panel \".concat(isTransitioning?'transitioning':''),style:{left:\"\".concat(((_positions$featureVi=positions['feature-view'])===null||_positions$featureVi===void 0?void 0:_positions$featureVi.x)||420,\"px\"),top:\"\".concat(((_positions$featureVi2=positions['feature-view'])===null||_positions$featureVi2===void 0?void 0:_positions$featureVi2.y)||80,\"px\"),width:\"\".concat(((_sizes$featureView=sizes['feature-view'])===null||_sizes$featureView===void 0?void 0:_sizes$featureView.width)||800,\"px\"),height:\"\".concat(((_sizes$featureView2=sizes['feature-view'])===null||_sizes$featureView2===void 0?void 0:_sizes$featureView2.height)||600,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-header\",onMouseDown:e=>handleDragStart(e,'feature-view'),children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleBackToActivities,className:\"back-button\",children:[/*#__PURE__*/_jsx(ArrowLeft,{size:16}),\"Back\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel-title\",children:[selectedFeature&&/*#__PURE__*/React.createElement(selectedFeature.icon,{size:18,style:{color:selectedFeature.color}}),/*#__PURE__*/_jsx(\"span\",{children:selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.name})]}),/*#__PURE__*/_jsx(\"div\",{className:\"panel-controls\",children:/*#__PURE__*/_jsx(Move,{size:14})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel-content\",children:[(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='content-generator'&&/*#__PURE__*/_jsx(ContentGeneratorModule,{onAIMessage:handleContentGeneratorMessage,generatedContent:generatedContent,onContentUpdate:handleContentUpdate,currentContentType:currentContentType// NEW: Niv real-time integration props\n,nivGeneratedData:nivGeneratedData,onNivEdit:async editData=>{// This will be handled by the onNivEdit prop of NivStrategicOrchestrator\n// For now, just trigger a message to Niv\nsetMessages(prev=>[...prev,{id:Date.now(),type:'user',content:editData.editRequest,timestamp:new Date()}]);},isNivGenerating:isNivGenerating}),(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='opportunity-engine'&&/*#__PURE__*/_jsx(OpportunityEngine,{onAIMessage:(message,featureId,contentType)=>{// If featureId is specified, switch to that feature\nif(featureId==='content-generator'){const contentGenActivity=activities.find(a=>a.id==='content-generator');if(contentGenActivity){handleActivityClick(contentGenActivity);// Send message after switching to Content Generator\nsetTimeout(()=>{sendMessage(message,null,contentType);},500);}}else{// Just send the message normally\nsendMessage(message);}},isDragging:draggedElement==='feature-view'}),(selectedFeature===null||selectedFeature===void 0?void 0:selectedFeature.id)==='strategic-planning'&&/*#__PURE__*/_jsx(StrategicPlanningOptimized,{initialData:strategicPlanData,onDataChange:setStrategicPlanData})]}),/*#__PURE__*/_jsx(\"div\",{className:\"resize-handle\",onMouseDown:e=>handleResizeStart(e,'feature-view')})]}),showNotepad&&/*#__PURE__*/_jsxs(\"div\",{id:\"notepad\",className:\"draggable-panel notepad-panel\",style:{left:\"\".concat(((_positions$notepad=positions['notepad'])===null||_positions$notepad===void 0?void 0:_positions$notepad.x)||940,\"px\"),top:\"\".concat(((_positions$notepad2=positions['notepad'])===null||_positions$notepad2===void 0?void 0:_positions$notepad2.y)||80,\"px\"),width:\"\".concat(((_sizes$notepad=sizes['notepad'])===null||_sizes$notepad===void 0?void 0:_sizes$notepad.width)||350,\"px\"),height:\"\".concat(((_sizes$notepad2=sizes['notepad'])===null||_sizes$notepad2===void 0?void 0:_sizes$notepad2.height)||400,\"px\"),display:notepadMinimized?'none':'block'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-header\",onMouseDown:e=>handleDragStart(e,'notepad'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-title\",children:[/*#__PURE__*/_jsx(StickyNote,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:\"Notes & Reminders\"}),/*#__PURE__*/_jsx(\"span\",{className:\"notes-count-badge\",children:notes.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setNotepadMinimized(!notepadMinimized),children:notepadMinimized?/*#__PURE__*/_jsx(Maximize2,{size:14}):/*#__PURE__*/_jsx(Minimize2,{size:14})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNotepad(false),children:/*#__PURE__*/_jsx(X,{size:14})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"panel-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"notepad-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"notepad-input-section\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:newNote,onChange:e=>setNewNote(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&e.ctrlKey){e.preventDefault();addNote();}},placeholder:\"Type a note or reminder... (Ctrl+Enter to save)\",className:\"notepad-textarea\",rows:3}),/*#__PURE__*/_jsxs(\"button\",{className:\"notepad-add-button\",onClick:addNote,disabled:!newNote.trim(),children:[/*#__PURE__*/_jsx(Plus,{size:14}),\"Add Note\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"notepad-notes-list\",children:notes.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"notepad-no-notes\",children:[/*#__PURE__*/_jsx(StickyNote,{size:24}),/*#__PURE__*/_jsx(\"p\",{children:\"No notes yet\"})]}):notes.map(note=>/*#__PURE__*/_jsxs(\"div\",{className:\"notepad-note-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"notepad-note-content\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"notepad-note-text\",children:note.text}),/*#__PURE__*/_jsxs(\"span\",{className:\"notepad-note-timestamp\",children:[new Date(note.timestamp).toLocaleDateString(),\" \",new Date(note.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"notepad-delete-button\",onClick:()=>deleteNote(note.id),children:/*#__PURE__*/_jsx(X,{size:14})})]},note.id))})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"resize-handle\",onMouseDown:e=>handleResizeStart(e,'notepad')})]}),showNewProjectModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowNewProjectModal(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Create New Project\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNewProjectModal(false),className:\"close-button\",children:/*#__PURE__*/_jsx(X,{size:20})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newProjectName,onChange:e=>setNewProjectName(e.target.value),placeholder:\"Enter project name...\",className:\"project-name-input\",autoFocus:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cancel-button\",onClick:()=>setShowNewProjectModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"create-button\",onClick:handleCreateProject,disabled:!newProjectName.trim(),children:\"Create Project\"})]})]})})]});};export default RailwayDraggable;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}